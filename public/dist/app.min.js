"use strict";var app=angular.module("app",["ngResource","ngRoute","ngSanitize","reCAPTCHA","nya.bootstrap.select","timer","ui.select","ui.bootstrap","btford.socket-io","uiGmapgoogle-maps"]).value("toastr",toastr).config(function(uiGmapGoogleMapApiProvider){uiGmapGoogleMapApiProvider.configure({v:"3.18",libraries:"geometry,visualization"})});app.run(function($rootScope,$location){$rootScope.$on("$routeChangeError",function(ev,current,previous,rejection){"not authorized"===rejection&&$location.path("/404")})}),app.config(function($locationProvider,reCAPTCHAProvider){$locationProvider.html5Mode({enabled:!0,requireBase:!1}),reCAPTCHAProvider.setPublicKey("6Lcy4csSAAAAAFdcvcxawMgzlJCabD0G5bk5lp2U"),reCAPTCHAProvider.setOptions({theme:"clean"})}),app.config(function($routeProvider){var routeUserChecks={adminRole:{authenticate:function(User){return User.isAuthorizedForRole("admin")}},librarianRole:{authenticate:function(User){return User.isAuthorizedForRole("librarian")}},libraryOwnerRole:{authenticate:function(User){return User.isAuthorizedForRole("libraryOwner")}},authenticated:{authenticate:function(User){return User.isAuthenticated()}}};$routeProvider.when("/admin",{templateUrl:"/partials/admin-panel/settings",controller:"AdminPanelCtrl",resolve:routeUserChecks.adminRole}).when("/admin/users",{templateUrl:"/partials/admin-panel/users/users-list",controller:"UserListCtrl",resolve:routeUserChecks.adminRole}).when("/admin/user/:id",{templateUrl:"/partials/admin-panel/users/users-info",controller:"UserInfoCtrl",resolve:routeUserChecks.adminRole}).when("/admin/users/add",{templateUrl:"/partials/admin-panel/users/user-add",controller:"AddUserAdminCtrl",resolve:routeUserChecks.adminRole}).when("/admin/user/edit/:id",{templateUrl:"/partials/admin-panel/users/user-edit",controller:"EditProfileAdminCtrl",resolve:routeUserChecks.adminRole}).when("/admin/user/delete/:id",{templateUrl:"/partials/admin-panel/users/user-delete",controller:"UserDeleteCtrl",resolve:routeUserChecks.adminRole}).when("/admin/libraries",{templateUrl:"/partials/admin-panel/libraries/libraries-list",controller:"LibraryListCtrl",resolve:routeUserChecks.adminRole}).when("/admin/libraries/add",{templateUrl:"/partials/admin-panel/libraries/library-add",controller:"AddLibraryCtrl",resolve:routeUserChecks.adminRole}).when("/admin/libraries/queue",{templateUrl:"/partials/admin-panel/libraries/library-queue",controller:"LibraryQueueCtrl",resolve:routeUserChecks.adminRole}).when("/admin/libraries/add/librarians",{templateUrl:"/partials/admin-panel/libraries/library-add-librarians",controller:"AddLibraryCtrl",resolve:routeUserChecks.adminRole}).when("/admin/library/:id",{templateUrl:"/partials/admin-panel/libraries/library-info",controller:"LibraryInfoCtrl",resolve:routeUserChecks.adminRole}).when("/admin/library/edit/:id",{templateUrl:"/partials/admin-panel/libraries/library-edit",controller:"EditLibraryAdminCtrl",resolve:routeUserChecks.adminRole}).when("/admin/library/delete/:id",{templateUrl:"/partials/admin-panel/libraries/library-delete",controller:"LibraryDeleteCtrl",resolve:routeUserChecks.adminRole}).when("/admin/books",{templateUrl:"/partials/admin-panel/books/books-list",controller:"BookListCtrl",resolve:routeUserChecks.adminRole}).when("/admin/book/:id",{templateUrl:"/partials/admin-panel/books/books-info",controller:"BookInfoCtrl",resolve:routeUserChecks.adminRole}).when("/admin/books/add",{templateUrl:"/partials/admin-panel/books/book-add",controller:"AddBookCtrl",resolve:routeUserChecks.adminRole}).when("/admin/book/edit/:id",{templateUrl:"/partials/admin-panel/books/book-edit",controller:"EditBookAdminCtrl",resolve:routeUserChecks.adminRole}).when("/admin/book/delete/:id",{templateUrl:"/partials/admin-panel/books/book-delete",controller:"BookDeleteCtrl",resolve:routeUserChecks.adminRole})}),app.config(function($routeProvider){$routeProvider.when("/",{templateUrl:"/partials/main/home",controller:"MainCtrl"}).when("/catalog",{templateUrl:"/partials/catalog/catalog",controller:"CatalogCtrl"}).when("/libraries",{templateUrl:"/partials/libraries/libraries-list",controller:"LibrariesListCtrl"}).when("/libraries/:id",{templateUrl:"/partials/libraries/library-details",controller:"LibraryDetailsCtrl"}).when("/book/:id",{templateUrl:"/partials/books/book-details",controller:"BookDetailsCtrl",reloadOnSearch:!1}).when("/book/:id/:libraryID",{templateUrl:"/partials/books/book-details",controller:"BookDetailsCtrl",reloadOnSearch:!1}).when("/search/:phrase",{templateUrl:"/partials/books/book-search",controller:"SearchCtrl"}).when("/advanced-search",{templateUrl:"/partials/search/advanced",controller:"AdvancedSearchCtrl"}).when("/404",{templateUrl:"/partials/404"}).otherwise({redirectTo:"/404"})}),app.config(function($routeProvider){var routeUserChecks={adminRole:{authenticate:function(User){return User.isAuthorizedForRole("admin")}},librarianRole:{authenticate:function(User){return User.isAuthorizedForRole("librarian")}},libraryOwnerRole:{authenticate:function(User){return User.isAuthorizedForRole("libraryOwner")}},authenticated:{authenticate:function(User){return User.isAuthenticated()}}};$routeProvider.when("/library-panel",{templateUrl:"/partials/library-panel/info",controller:"LibraryPanelCtrl",resolve:routeUserChecks.librarianRole}).when("/library-panel/library-details",{templateUrl:"/partials/library-panel/info",controller:"LibraryInfoCtrl",resolve:routeUserChecks.librarianRole}).when("/library-panel/library-settings",{templateUrl:"/partials/library-panel/settings",controller:"LibrarySettingsCtrl",resolve:routeUserChecks.librarianRole}).when("/library-panel/books/add",{templateUrl:"/partials/library-panel/books/book-add",controller:"LibraryAddBookCtrl",resolve:routeUserChecks.librarianRole}).when("/library-panel/bookInfo/:id",{templateUrl:"/partials/library-panel/books/books-info",controller:"BookInfoLibCtrl",resolve:routeUserChecks.librarianRole}).when("/library-panel/books-library",{templateUrl:"/partials/library-panel/books/books-list",controller:"LibraryBooksListCtrl",resolve:routeUserChecks.librarianRole}).when("/library-panel/books-library/:section",{templateUrl:"/partials/library-panel/books/books-list",controller:"LibraryBooksListCtrl",resolve:routeUserChecks.librarianRole}).when("/library-panel/books/search",{templateUrl:"/partials/library-panel/books/books-search",controller:"LibraryBooksSearchCtrl",resolve:routeUserChecks.librarianRole}).when("/library-panel/book/edit/:id",{templateUrl:"/partials/library-panel/books/book-edit",controller:"EditBookLibraryCtrl",resolve:routeUserChecks.librarianRole}).when("/library-panel/book/delete/:id",{templateUrl:"/partials/library-panel/books/book-delete",controller:"LibraryBookDeleteCtrl",resolve:routeUserChecks.librarianRole}).when("/library-panel/users",{templateUrl:"/partials/library-panel/users/users-list",controller:"LibraryUsersCtrl",resolve:routeUserChecks.librarianRole}).when("/library-panel/userInfo/:id",{templateUrl:"/partials/library-panel/users/user-info",controller:"UserInfoLibraryCtrl",resolve:routeUserChecks.librarianRole}).when("/library-panel/user/interact/:id",{templateUrl:"/partials/library-panel/users/user-interact",controller:"UserInteractLibraryCtrl",resolve:routeUserChecks.librarianRole}).when("/library-panel/user/delete/:id",{templateUrl:"/partials/library-panel/users/user-delete",controller:"UserDeleteFromLibraryCtrl",resolve:routeUserChecks.librarianRole}).when("/library-panel/users/book-reservations",{templateUrl:"/partials/library-panel/users/book-reservations",controller:"BookingReservationsCtrl",resolve:routeUserChecks.librarianRole}).when("/library-panel/users/books-taken",{templateUrl:"/partials/library-panel/users/books-taken",controller:"BooksTakenCtrl",resolve:routeUserChecks.librarianRole}).when("/library-panel/users/visits",{templateUrl:"/partials/library-panel/users/visits",controller:"LibraryVisitsCtrl",resolve:routeUserChecks.librarianRole}).when("/library-panel/fines",{templateUrl:"/partials/library-panel/fines/fines-list",controller:"LibraryFinesListCtrl",resolve:routeUserChecks.librarianRole}).when("/library-panel/fine/:id",{templateUrl:"/partials/library-panel/fines/fine-info",controller:"LibraryFineInfoCtrl",resolve:routeUserChecks.librarianRole}).when("/library-panel/add-fine/:userID",{templateUrl:"/partials/library-panel/fines/add-fine",controller:"LibraryAddFineCtrl",resolve:routeUserChecks.librarianRole}).when("/library-panel/fine-paid/:id",{templateUrl:"/partials/library-panel/fines/fine-paid",controller:"FinePaidLibraryCtrl",resolve:routeUserChecks.librarianRole}).when("/library-panel/fine-remove/:id",{templateUrl:"/partials/library-panel/fines/fine-remove",controller:"FineDeleteFromLibraryCtrl",resolve:routeUserChecks.librarianRole})}),app.config(function($routeProvider){var routeUserChecks={adminRole:{authenticate:function(User){return User.isAuthorizedForRole("admin")}},librarianRole:{authenticate:function(User){return User.isAuthorizedForRole("librarian")}},libraryOwnerRole:{authenticate:function(User){return User.isAuthorizedForRole("libraryOwner")}},authenticated:{authenticate:function(User){return User.isAuthenticated()}}};$routeProvider.when("/register-library",{templateUrl:"/partials/account/register-library",controller:"RegisterLibraryCtrl"}).when("/signup",{templateUrl:"/partials/account/sign-up",controller:"SignUpCtrl"}).when("/login",{templateUrl:"/partials/account/log-in",controller:"LogInCtrl"}).when("/profile",{templateUrl:"/partials/account/profile",controller:"ProfileCtrl",resolve:routeUserChecks.authenticated}).when("/thank-you",{templateUrl:"/partials/account/thank-you",resolve:routeUserChecks.authenticated}).when("/profile/edit",{templateUrl:"/partials/account/edit-profile",controller:"EditProfileCtrl",resolve:routeUserChecks.authenticated})}),app.controller("EditProfileCtrl",function($scope,$location,$filter,User,identity,ajaxPost,$window,$http,notifier){$scope.user=identity.currentUser,$scope.upload=!1,$scope.emailConfirm=$scope.user.email,$scope.update=function(user){User.update(user).then(function(){$scope.user=user,window.location.href="/profile",notifier.success("Profile updated!")},function(reason){reason instanceof Object?(notifier.error($filter("titleCase")(reason.name)),$scope.mongooseErrors=reason.errors):notifier.error(reason)})},$scope.today=new Date,$scope.setFileEventListener=function(element){$scope.uploadedFile=element.files[0],$scope.uploadedFile&&$scope.$apply(function(){$scope.uploadButtonState=!0})},$scope.uploadFile=function(){$scope.uploadedFile&&ajaxPost.uploadFileInit($scope.uploadedFile).then(function(result){200===result.status&&($scope.user.avatar=result.data,$scope.avatarUploadSuccessful=!0,$scope.avatarUploadError=!1,$scope.avatarTypeError=!1)},function(error){console.log(error),"Invalid mime type"===error.data?$scope.avatarTypeError=!0:$scope.avatarUploadError=!0,$scope.avatarError=error.data})}}),app.controller("LogInCtrl",function($scope,$location,notifier,identity,User,$window){$scope.identity=identity,$scope.login=function(user){User.login(user).then(function(success){success?(notifier.success("Successful login!"),$window.location.href="/profile"):(notifier.error("Username/Password combination is not valid or the RECAPTCHA Challenge is not complete!"),$window.Recaptcha.reload())})},$scope.loginNoCaptcha=function(user){User.loginNoCaptcha(user).then(function(success){success?(notifier.success("Successful login!"),$window.location.href="/profile"):notifier.error("Username/Password combination is not valid!")})},$scope.logout=function(){User.logout().then(function(){notifier.success("Successful logout!"),$scope.user&&($scope.user.username="",$scope.user.password=""),$location.path("/")})}}),app.controller("NotificationsCtrl",function($scope,$http,Socket,NotificationService,identity){$scope.identity=identity,$scope.user=identity.currentUser;var loadNotifications=function(callback){NotificationService.getForUser($scope.user).then(function(notifications){return notifications.reverse(),callback(notifications)})},triggerDesktopNotification=function(notificationMessage){if("Notification"in window)if("granted"===Notification.permission){new Notification("New sCOOLbry notification!",{body:notificationMessage.replace(/(<([^>]+)>)/gi,""),icon:"../../dist/images/favicon.png"})}else"denied"!==Notification.permission&&Notification.requestPermission(function(permission){if("granted"===permission){new Notification("New sCOOLbry notification!",{body:notificationMessage.replace(/(<([^>]+)>)/gi,""),icon:"../../dist/images/favicon.png"})}});else alert("This browser does not support desktop notification")};$scope.markAsSeen=function(notification){notification.seen=!0,NotificationService.markAsSeen(notification)},$scope.user&&(loadNotifications(function(notifications){$scope.notifications=notifications}),Socket.on($scope.user._id+" notification added",function(notification){triggerDesktopNotification(notification.message),$scope.notifications.unshift(notification)}),Socket.on($scope.user._id+" notification removed",function(notification){for(var i=0;i<$scope.notifications.length;i++)if($scope.notifications[i]._id===notification._id){$scope.notifications.splice(i,1);break}}))}),app.controller("ProfileCtrl",function($scope,$http,$timeout,$location,notifier,identity,UserResource,LibraryResource,FavoriteBookResource,UserReadingProfileResource,UserBookingsResource,UserFinesResource){$scope.user=UserResource.get({id:identity.currentUser._id},function(data){data?(data.dateOfBirth=data.dateOfBirth||"N/A",data.facebookUrl=data.facebookUrl||"N/A",data.twitterUrl=data.twitterUrl||"N/A",data.googlePlusUrl=data.googlePlusUrl||"N/A",data.aboutMe=data.aboutMe||"N/A"):$location.path("/404"),data.libraries=[],data.readings=UserReadingProfileResource.get({userID:data._id}),data.bookings=UserBookingsResource.get({userID:data._id});for(var lib=0;lib<data.librarySubscriptions.length;lib++)data.libraries[lib]=LibraryResource.get({id:data.librarySubscriptions[lib]})},function(){$location.path("/404")}),$scope.favoriteBooks=FavoriteBookResource.get({userID:identity.currentUser._id}),$scope.fines=UserFinesResource.get({userID:identity.currentUser._id})}),app.controller("RegisterLibraryCtrl",function($scope,$http,$location,$window,$anchorScroll,$filter,Library,User,notifier,UserResource,ajaxPost){$scope.library=new Object({}),$scope.library.workdays=[],$scope.library.workHoursOpeningHour=[],$scope.library.workHoursClosingHour=[],$scope.library.workHoursOpeningMinutes=[],$scope.library.workHoursClosingMinutes=[];for(var i=0;7>i;i++)$scope.library.workdays[i]=!0,$scope.library.workHoursOpeningHour[i]=10,$scope.library.workHoursClosingHour[i]=18,$scope.library.workHoursOpeningMinutes[i]=0,$scope.library.workHoursClosingMinutes[i]=0;$http({method:"get",cache:!0,url:"/api/currency"}).success(function(data){$scope.currency=data}).error(function(err){console.log(err)}),$scope.refreshAddresses=function(address){var params={address:address,sensor:!1};return $http.get("http://maps.googleapis.com/maps/api/geocode/json",{params:params}).then(function(response){console.log(response),$scope.addresses=response.data.results})},$scope.addLibrary=function(){console.log($scope.library.tax);for(var workdays=[],workhours=[],workhoursString="",i=0;7>i;i++)$scope.library.workdays[i]===!0&&(workdays[i]=!0,workhoursString=$scope.library.workHoursOpeningHour[i]+":"+$scope.library.workHoursOpeningMinutes[i]+"-"+$scope.library.workHoursClosingHour[i]+":"+$scope.library.workHoursClosingMinutes[i],workhours[i]=workhoursString);delete $scope.library.workdays,delete $scope.library.workhours,$scope.library.workdays=workdays,$scope.library.workhours=workhours,Library.registerLibrary($scope.library,$scope.librarians[0]).then(function(){notifier.success("Library added successfully!"),$location.path("/library-panel"),$anchorScroll()},function(reason){reason instanceof Object?($scope.mongooseErrors=reason.errors||[reason],console.log($scope.mongooseErrors),notifier.error($filter("titleCase")(reason.name))):notifier.error(reason),$window.Recaptcha.reload()})},$http({method:"get",cache:!0,url:"/api/countries"}).success(function(data){$scope.countries=data}).error(function(err){console.log(err)}),$scope.setFileEventListener=function(element){$scope.uploadedFile=element.files[0],"undefined"==typeof $scope.library&&($scope.library=new Object({})),$scope.library.active=!0,$scope.uploadedFile&&$scope.$apply(function(){$scope.uploadButtonState=!0})},$scope.uploadFile=function(){console.log("upload file"),$scope.uploadedFile&&ajaxPost.uploadFileInit($scope.uploadedFile).then(function(result){200===result.status&&($scope.library.certificate=result.data,$scope.certificateUploadSuccessful=!0,$scope.certificateUploadError=!1,$scope.certificateTypeError=!1,$scope.uploadButtonState=!0,$scope.uploadedFile=!0)},function(error){console.log(error),"Invalid mime type"===error.data?$scope.certificateTypeError=!0:$scope.certificateUploadError=!0,$scope.certificateError=error.data})},$scope.librariansCount=1,$scope.librarians=[];for(var i=0;i<$scope.librariansCount;i++)$scope.librarians[i]=new Object({index:i}),$scope.librarians[i].roles=["libraryOwner","standart"]}),app.controller("SignUpCtrl",function($scope,$location,User,notifier,$http,$window,$filter){var handleError=function(reason){reason instanceof Object?(notifier.error($filter("titleCase")(reason.name)),$scope.mongooseErrors=reason.errors):notifier.error(reason)};$scope.signup=function(){User.signup($scope.user).then(function(){notifier.success("Registration successful!"),$location.path("/")},function(reason){handleError(reason),$window.Recaptcha.reload()})},$scope.signupNoCaptcha=function(){User.signupNoCaptcha($scope.user).then(function(){notifier.success("Registration successful!"),$location.path("/")},function(reason){handleError(reason)})}}),app.controller("StyleCtrl",function($scope,identity){$scope.style="undefined"==typeof identity.currentUser?"darkly":identity.currentUser.style}),app.controller("AdminPanelCtrl",function($scope,$location,$http,identity){$scope.identity=identity,$scope.path=$location.path(),$scope.menu=[{name:"libraries",links:{add:"/admin/libraries/add",browse:"/admin/libraries",queue:"/admin/libraries/queue"}},{name:"books",links:{add:"/admin/books/add",browse:"/admin/books"}},{name:"users",links:{add:"/admin/users/add",browse:"/admin/users"}}],$scope.getCurrentMenuItem=function(path){for(var i=0;i<$scope.menu.length;i++)for(var key in $scope.menu[i].links)if($scope.menu[i].links[key]===path)return $scope.menu[i].name;return""},$scope.currentMenuItem=$scope.getCurrentMenuItem($scope.path),$http.get("/api/library/late-readings").success(function(){console.log("fined")}).error(function(data){console.log("error: "+data)})}),app.controller("AddBookCtrl",function($scope,$window,$http,$anchorScroll,$filter,$location,Book,bookSearch,notifier,ajaxPost){$scope.today=new Date;var handleError=function(reason){console.log(reason),reason instanceof Object?(notifier.error($filter("titleCase")(reason.data.reason.name)),$scope.mongooseErrors=reason.data.reason.errors):notifier.error(reason)};$http({method:"get",cache:!0,url:"/api/genres"}).success(function(data){$scope.genres=data}).error(function(err){console.log(err)}),$scope.uploadEbook=function(index){var fd=new FormData;fd.append("file",$scope.uploadedFile),$http.post("/api/books/upload",fd,{withCredentials:!0,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(data){$scope.books[index].ebookUrl=data,$scope.ebookUploadSuccess="Ebook successfully uploaded",$scope.ebookUploadError=void 0,console.log(data)}).error(function error(error){error.reason&&(console.log(error),$scope.ebookUploadError=error.reason.name||error.reason,$scope.ebookUploadSuccess=void 0)})},$scope.page=1,$scope.perPage=3,$scope.field="_id",$scope.range=function(n){return new Array(n)},$scope.getPagesCount=function(){return $scope.booksCount=$scope.books.length,$scope.pagesCount=Math.ceil($scope.booksCount/$scope.perPage),$scope.pagesCount},$scope.setPage=function(page,event){$scope.page=page,$anchorScroll(),angular.element(".pagination li").removeClass("active"),angular.element("#"+event.target.id).parent().addClass("active")},$scope.setPerPage=function(perPage){$scope.perPage=perPage};var fieldsOptions=[],fieldsOptionsCopy=[];$scope.fields=[],$scope.matches=[],$http({method:"get",cache:!0,url:"/api/books/fields/false"}).success(function(data){fieldsOptions=data,fieldsOptionsCopy=fieldsOptions;for(var i=0;20>i;i++)$scope.fields.push(fieldsOptions)}).error(function(err){console.log(err)}),$scope.updateSelections=function(key,value){$scope.matches[key]=value;for(var i=0;i<Object.keys($scope.result[0]).length;i++){$scope.fields[i]=[];for(var j=0;j<fieldsOptionsCopy.length;j++)$scope.matches.indexOf(fieldsOptionsCopy[j])<0&&$scope.fields[i].push(fieldsOptionsCopy[j])}$scope.matches.forEach(function(element,index){$scope.fields[index].push(element)})},$scope.showCSVForms=function(includeTopRow,sheet,notDisplayingForm){$scope.books=[];for(var len=sheet&&$scope.result.sheets[sheet].data.length||$scope.result.length,i=includeTopRow?0:1;len>i;i++){for(var book={},j=0;j<fieldsOptions.length;j++)"undefined"!=typeof $scope.matches[j]&&(book[$scope.matches[j]]=sheet?$scope.result.sheets[sheet].data[i][j]:$scope.result[i][j]);$scope.books.push(book)}notDisplayingForm||($scope.displayForm=!0,$anchorScroll())},$scope.importAll=function(includeTopRow,sheet){for(var results=sheet?$scope.result.sheets[sheet].data[0]:$scope.result[0],matches={},i=0;i<$scope.matches.length;i++)"undefined"!=typeof $scope.matches[i]&&(matches[$scope.matches[i]]=results[i]);matches=JSON.stringify(matches);var fd=new FormData;fd.append("file",$scope.file),fd.append("matches",matches),fd.append("topRow",includeTopRow),fd.append("sheet",sheet),$scope.loading=!0,$http.post("/api/books/import",fd,{withCredentials:!0,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(data){console.log(data),notifier.success("All books were added successfully"),$location.path("/admin/books")}).error(function error(error){console.log(error),error.reason&&notifier.error(error.reason),error.failed&&(notifier.error("Some books were not added. Please check all fields."),$scope.books=error.failed,$scope.displayForm=!0,$anchorScroll())}).finally(function(){$scope.loading=!1})},$scope.removeBookForm=function(index){$scope.books.splice(index,1),notifier.success("Book Form removed successfully!"),$scope.books.length<1&&($scope.displayForm=!1,$scope.csv=!1,$scope.searchState=void 0)},$scope.addBook=function(book,index){Book.add(book).then(function(){notifier.success("Book added successfully!"),$scope.books.splice(index,1),$scope.books.length<1&&($window.location.href="/admin/books")},function(reason){handleError(reason)})},$scope.newForm=function(){$scope.books=[],$scope.books[0]=new Object({}),$scope.displayForm=!0,$scope.searchState=void 0},$scope.findBook=function(){$scope.searchState=void 0,$scope.found=void 0,angular.element("#searchByIsbnButton").trigger("click");var bookPromise=bookSearch.search($scope.ISBNSearch);bookPromise.then(function(data){data.foundInDatabase===!0?($scope.searchState=!1,$scope.bookURL="/admin/book/"+data._id):($scope.books=[],data.isbn=$scope.ISBNSearch.replace(/-/gi,""),$scope.books[0]=data,$scope.displayForm=!0,$scope.searchState=!0)},function(){$scope.searchState=!1,$scope.found=!1,angular.element("#searchByIsbn").select()})},$scope.displayForm=!1,$scope.setFileEventListener=function(element){"undefined"==typeof $scope.books&&($scope.books[0]=new Object({})),$scope.uploadedFile=element.files[0],$scope.uploadedFile&&$scope.$apply(function(){$scope.uploadButtonState=!0})},$scope.uploadFile=function(index){$scope.uploadedFile&&ajaxPost.uploadFileInit($scope.uploadedFile).then(function(result){200===result.status&&($scope.books[index].cover=result.data,$scope.coverUploadSuccessful=!0,$scope.coverUploadError=!1,$scope.coverTypeError=!1)},function(error){"Invalid mime type"===error.data?$scope.coverTypeError=!0:$scope.coverUploadError=!0,$scope.coverError=error.data})}}),app.controller("BookDeleteCtrl",function($scope,$routeParams,$http,$location,notifier){$http.get("/api/book/delete/"+$routeParams.id).success(function(){notifier.success("The book has been successfully deleted.")}),$location.path("/admin/books")}),app.controller("BookInfoCtrl",function($scope,BookResource,$routeParams,$location){$scope.showMore=!0,$scope.book=BookResource.get({id:$routeParams.id},function(data){data||$location.path("/404")},function(){$location.path("/404")})}),app.controller("BookListCtrl",function($scope,BookResourceSortable,$routeParams,$http){$scope.page=1,$scope.perPage=150,$scope.field="uploaded",$scope.order="desc",$scope.range=function(n){return new Array(n)},$scope.pages=function(){$http.get("/api/book/count").success(function(data){$scope.booksCount=parseInt(data),$scope.pagesCount=Math.ceil($scope.booksCount/$scope.perPage)})},$scope.books=BookResourceSortable.query({field:$scope.field,order:$scope.order,page:$scope.page,perPage:$scope.perPage}),$scope.setPage=function(page,event){$scope.page=page,angular.element(".pagination li").removeClass("active"),angular.element("#"+event.target.id).parent().addClass("active")},$scope.setPerPage=function(perPage){$scope.perPage=perPage},$scope.sort=function(event){$scope.field=event.target.id,$scope.order=$scope.order="asc"===$scope.order?"desc":"asc"},$scope.reloadBooks=function(){$scope.books=BookResourceSortable.query({field:$scope.field,order:$scope.order,page:$scope.page,perPage:$scope.perPage})}}),app.controller("BooksListCtrl",function($scope,cachedBooks){$scope.books=cachedBooks.query()}),app.controller("EditBookAdminCtrl",function($scope,$location,$http,$filter,Book,ajaxPost,BookResource,notifier,$routeParams){$scope.today=new Date;var handleError=function(reason){reason instanceof Object?(notifier.error($filter("titleCase")(reason.data.reason.name)),$scope.mongooseErrors=reason.data.reason.errors):notifier.error(reason)};$scope.book=BookResource.get({id:$routeParams.id},function(data){data||$location.path("/404")},function(){$location.path("/404")}),$http({method:"get",cache:!0,url:"/api/genres"}).success(function(data){$scope.genres=data}).error(function(err){console.log(err)}),$scope.uploadEbook=function(){var fd=new FormData;fd.append("file",$scope.uploadedFile),$http.post("/api/books/upload",fd,{withCredentials:!0,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(data){$scope.book.ebookUrl=data,$scope.ebookUploadSuccess="Ebook successfully uploaded",$scope.ebookUploadError=void 0,console.log(data)}).error(function error(error){error.reason&&(console.log(error),$scope.ebookUploadError=error.reason.name||error.reason,$scope.ebookUploadSuccess=void 0)})},$scope.update=function(book){Book.update(book).then(function(){notifier.success("Book updated successfully!"),$location.path("/admin/books")},function(reason){console.log(reason),handleError(reason)})},$scope.uploadButtonState=!1,$scope.setFileEventListener=function(element){$scope.uploadedFile=element.files[0],$scope.uploadedFile&&$scope.$apply(function(){$scope.uploadButtonState=!0})},$scope.uploadFile=function(){$scope.uploadedFile&&ajaxPost.uploadFileInit($scope.uploadedFile).then(function(result){200===result.status&&($scope.book.cover=result.data,$scope.coverUploadSuccessful=!0,$scope.coverUploadError=!1,$scope.coverTypeError=!1)},function(error){"Invalid mime type"===error.data?$scope.coverTypeError=!0:$scope.coverUploadError=!0,$scope.coverError=error.data})}}),app.controller("AddLibraryCtrl",function($scope,$http,$window,$filter,Library,User,notifier,UserResource,ajaxPost){$scope.library=new Object({}),$scope.library.workdays=[],$scope.library.workHoursOpeningHour=[],$scope.library.workHoursClosingHour=[],$scope.library.workHoursOpeningMinutes=[],$scope.library.workHoursClosingMinutes=[];for(var i=0;7>i;i++)$scope.library.workdays[i]=!0,$scope.library.workHoursOpeningHour[i]=10,$scope.library.workHoursClosingHour[i]=18,$scope.library.workHoursOpeningMinutes[i]=0,$scope.library.workHoursClosingMinutes[i]=0;$scope.refreshAddresses=function(address){var params={address:address,sensor:!1};return $http.get("http://maps.googleapis.com/maps/api/geocode/json",{params:params}).then(function(response){$scope.addresses=response.data.results})},$http({method:"get",cache:!0,url:"/api/currency"}).success(function(data){$scope.currency=data}).error(function(err){console.log(err)}),$scope.addLibrary=function(library,librarians){for(var workdays=[],workhours=[],workhoursString="",i=0;7>i;i++)library.workdays[i]===!0&&(workdays[i]=!0,workhoursString=library.workHoursOpeningHour[i]+":"+library.workHoursOpeningMinutes[i]+"-"+library.workHoursClosingHour[i]+":"+library.workHoursClosingMinutes[i],workhours[i]=workhoursString);delete library.workdays,delete library.workhours,library.workdays=workdays,library.workhours=workhours;for(var i=0;i<librarians.length;i++)librarians[i].roles=[],librarians[i].roles.push("librarian");if(library.hasOwnProperty("librarians"))for(var i=0;i<library.librarians.length;i++)if(library.librarians[i].hasOwnProperty("roles")===!1||-1===library.librarians[i].roles.indexOf("librarian"))for(var j=0;j<$scope.users.length;j++)$scope.users[j]._id===library.librarians[i]._id&&($scope.users[j].roles.push("librarian"),User.updateAsAdmin($scope.users[j]).then(function(){},function(reason){notifier.error(reason)}));Library.addLibrary(library,librarians).finally(function(){notifier.success("Library added successfully!"),$window.location.href="/admin/libraries"},function(reason){reason instanceof Object?($scope.mongooseErrors=reason.errors||[reason],console.log($scope.mongooseErrors),notifier.error($filter("titleCase")(reason.name))):notifier.error(reason)})},$http({method:"get",cache:!0,url:"/api/countries"}).success(function(data){$scope.countries=data}).error(function(err){console.log(err)}),$http({method:"get",url:"/api/users"}).success(function(data){$scope.users=[];for(var user in data)""!==data[user].ownLibraryID&&data[user].ownLibraryID||$scope.users.push(data[user])}).error(function(err){console.log(err)}),$scope.setFileEventListener=function(element){$scope.uploadedFile=element.files[0],"undefined"==typeof $scope.library&&($scope.library=new Object({})),$scope.library.active=!0,$scope.uploadedFile&&$scope.$apply(function(){$scope.uploadButtonState=!0})},$scope.uploadFile=function(){$scope.uploadedFile&&ajaxPost.uploadFileInit($scope.uploadedFile).then(function(result){200===result.status&&($scope.library.certificate=result.data,$scope.certificateUploadSuccessful=!0,$scope.certificateUploadError=!1,$scope.certificateTypeError=!1,$scope.uploadButtonState=!0,$scope.uploadedFile=!0)},function(error){console.log(error),"Invalid mime type"===error.data?$scope.certificateTypeError=!0:$scope.certificateUploadError=!0,$scope.certificateError=error.data})},$scope.librariansCount=0,$scope.librarians=[];for(var i=0;i<$scope.librariansCount;i++)$scope.librarians[i]=new Object({index:i});$scope.addLibrarian=function(){$scope.librarians[$scope.librariansCount]=new Object({index:$scope.librariansCount}),$scope.librariansCount++},$scope.removeLibrarian=function(index){$scope.librarians.splice(index,1),$scope.librariansCount--}}),app.controller("EditLibraryAdminCtrl",function($scope,$http,$location,$window,Library,User,$filter,notifier,UserResource,ajaxPost,LibraryResource,$routeParams){$scope.currentLibrarians=[],$scope.library=LibraryResource.get({id:$routeParams.id},function(data){if(data){$scope.library.workHoursClosingMinutes=[],$scope.library.workHoursOpeningHour=[],$scope.library.workHoursOpeningMinutes=[],$scope.library.workHoursClosingHour=[];for(var i=0;7>i;i++)if(data.workdays[i]===!0){var daySchedule=data.workhours[i];$scope.library.workHoursOpeningHour[i]=parseInt(daySchedule.substring(0,daySchedule.indexOf(":"))),$scope.library.workHoursOpeningMinutes[i]=parseInt(daySchedule.substring(daySchedule.indexOf(":")+1,daySchedule.indexOf("-"))),$scope.library.workHoursClosingHour[i]=parseInt(daySchedule.substring(daySchedule.indexOf("-")+1,daySchedule.lastIndexOf(":"))),$scope.library.workHoursClosingMinutes[i]=parseInt(daySchedule.substring(daySchedule.lastIndexOf(":")+1,daySchedule.length))
}for(var index in $scope.library.librarians)UserResource.get({id:$scope.library.librarians[index]},function(data){$scope.currentLibrarians.push(data),$scope.library.librarians.splice(index,1)})}else $location.path("/404")},function(){$location.path("/404")}),$http({method:"get",cache:!0,url:"/api/currency"}).success(function(data){$scope.currency=data}).error(function(err){console.log(err)}),$scope.predicate="_id",$scope.reverse=!1,$scope.refreshAddresses=function(address){var params={address:address,sensor:!1};return $http.get("http://maps.googleapis.com/maps/api/geocode/json",{params:params}).then(function(response){$scope.addresses=response.data.results})},$scope.updateLibrary=function(library,librarians){for(var workdays=[],workhours=[],workhoursString="",i=0;7>i;i++)library.workdays[i]===!0&&(workdays[i]=!0,workhoursString=library.workHoursOpeningHour[i]+":"+library.workHoursOpeningMinutes[i]+"-"+library.workHoursClosingHour[i]+":"+library.workHoursClosingMinutes[i],workhours[i]=workhoursString);delete library.workdays,delete library.workhours,library.workdays=workdays,library.workhours=workhours;for(var i=0;i<$scope.removedLibrarians.length;i++)User.updateAsAdmin($scope.removedLibrarians[i]);for(var i=0;i<librarians.length;i++)librarians[i].roles=[],librarians[i].roles.push("librarian");if(library.hasOwnProperty("librarians"))for(var i=0;i<library.librarians.length;i++)if(console.log(library.librarians[i]),library.librarians[i].hasOwnProperty("roles")===!1||-1===library.librarians[i].roles.indexOf("librarian"))for(var j=0;j<$scope.users.length;j++)$scope.users[j]._id===library.librarians[i]._id&&($scope.users[j].roles.push("librarian"),User.updateAsAdmin($scope.users[j]).then(function(){},function(reason){notifier.error(reason)}));for(var index in $scope.currentLibrarians)library.librarians.push($scope.currentLibrarians[index]._id);Library.updateLibrary(library,librarians).then(function(){notifier.success("Library updated!"),$window.location.href="/admin/libraries"},function(reason){reason instanceof Object?($scope.mongooseErrors=reason.errors||[reason],console.log($scope.mongooseErrors),notifier.error($filter("titleCase")(reason.name))):notifier.error(reason)})},$scope.removedLibrarians=[],$scope.removeCurrentLibrarian=function(librarian){$scope.currentLibrarians.splice($scope.currentLibrarians.indexOf(librarian),1),librarian.ownLibraryID="",librarian.roles.indexOf("librarian")>-1&&librarian.roles.splice(librarian.roles.indexOf("librarian"),1),librarian.roles.indexOf("libraryOwner")>-1&&librarian.roles.splice(librarian.roles.indexOf("libraryOwner"),1),$scope.removedLibrarians.push(librarian)},$http({method:"get",url:"/api/users"}).success(function(data){$scope.users=[];for(var user in data)""!==data[user].ownLibraryID&&data[user].ownLibraryID||$scope.users.push(data[user])}).error(function(err){console.log(err)}),$scope.setFileEventListener=function(element){$scope.uploadedFile=element.files[0],"undefined"==typeof $scope.library&&($scope.library=new Object({})),$scope.library.active=!0,$scope.uploadedFile&&$scope.$apply(function(){$scope.uploadButtonState=!0})},$scope.uploadFile=function(){$scope.uploadedFile&&ajaxPost.uploadFileInit($scope.uploadedFile).then(function(result){200===result.status&&($scope.library.certificate=result.data,$scope.certificateUploadSuccessful=!0,$scope.certificateUploadError=!1,$scope.certificateTypeError=!1,$scope.uploadButtonState=!0,$scope.uploadedFile=!0)},function(error){console.log(error),"Invalid mime type"===error.data?$scope.certificateTypeError=!0:$scope.certificateUploadError=!0,$scope.certificateError=error.data})},$scope.librariansCount=0,$scope.librarians=[];for(var i=0;i<$scope.librariansCount;i++)$scope.librarians[i]=new Object({index:i});$scope.addLibrarian=function(){$scope.librarians[$scope.librariansCount]=new Object({index:$scope.librariansCount}),$scope.librariansCount++},$scope.removeLibrarian=function(index){$scope.librarians.splice(index,1),$scope.librariansCount--}}),app.controller("LibraryDeleteCtrl",function($scope,$routeParams,$http,$location,notifier){$http.get("/api/library/delete/"+$routeParams.id).success(function(){notifier.success("The library has been successfully deleted.")}),$location.path("/admin/libraries")}),app.controller("LibraryInfoCtrl",function($scope,$location,$http,LibraryResource,LibraryUsersResourceSortable,uiGmapGoogleMapApi,LibBooksResource,identity,$routeParams){var libraryID=$routeParams.id||identity.currentUser.ownLibraryID;console.log(libraryID),$scope.library=LibraryResource.get({id:libraryID},function(data){data?uiGmapGoogleMapApi.then(function(){$scope.map={center:{latitude:$scope.library.address.geometry.location.lat,longitude:$scope.library.address.geometry.location.lng},zoom:16},$scope.marker={coords:{latitude:$scope.library.address.geometry.location.lat,longitude:$scope.library.address.geometry.location.lng},idkey:0,icon:"../../dist/images/bluemarker.png",options:{animation:1,labelContent:$scope.library.name,labelClass:"marker-labels",labelAnchor:"24 4"}}}):$location.path("/404")},function(){$location.path("/404")}),$scope.libraryBooks=LibBooksResource.get({id:libraryID}),$scope.libraryUsers=LibraryUsersResourceSortable.query({id:libraryID},function(data){console.log(data)}),$scope.days=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],$http.get("/api/library/user-count/"+libraryID).success(function(data){$scope.membersCount=data})}),app.controller("LibraryListCtrl",function($scope,LibraryResourceSortable,$routeParams,$http){$scope.page=1,$scope.perPage=10,$scope.field="_id",$scope.order="asc",$scope.range=function(n){return new Array(n)},$scope.pages=function(){$http.get("/api/library/count").success(function(data){$scope.librariesCount=parseInt(data),$scope.pagesCount=Math.ceil($scope.librariesCount/$scope.perPage)})},$scope.libraries=LibraryResourceSortable.query({field:$scope.field,order:$scope.order,page:$scope.page,perPage:$scope.perPage}),$scope.setPage=function(page,event){$scope.page=page,angular.element(".pagination li").removeClass("active"),angular.element("#"+event.target.id).parent().addClass("active")},$scope.setPerPage=function(perPage){$scope.perPage=perPage},$scope.sort=function(event){$scope.field=event.target.id,$scope.order=$scope.order="asc"===$scope.order?"desc":"asc"},$scope.reloadLibraries=function(){$scope.libraries=LibraryResourceSortable.query({field:$scope.field,order:$scope.order,page:$scope.page,perPage:$scope.perPage})}}),app.controller("LibraryQueueCtrl",function($scope,LibraryResourceSortable,$routeParams,$http){$scope.page=1,$scope.perPage=10,$scope.field="published",$scope.order="desc",$scope.range=function(n){return new Array(n)},$scope.pages=function(){$http.get("/api/library/count").success(function(data){$scope.librariesCount=parseInt(data),$scope.pagesCount=Math.ceil($scope.librariesCount/$scope.perPage)})},$scope.libraries=LibraryResourceSortable.query({field:$scope.field,order:$scope.order,page:$scope.page,perPage:$scope.perPage}),$scope.setPage=function(page,event){$scope.page=page,angular.element(".pagination li").removeClass("active"),angular.element("#"+event.target.id).parent().addClass("active")},$scope.setPerPage=function(perPage){$scope.perPage=perPage},$scope.sort=function(event){$scope.field=event.target.id,$scope.order=$scope.order="asc"===$scope.order?"desc":"asc"},$scope.reloadLibraries=function(){$scope.libraries=LibraryResourceSortable.query({field:$scope.field,order:$scope.order,page:$scope.page,perPage:$scope.perPage})}}),app.controller("AddUserAdminCtrl",function($scope,$location,$routeParams,$http,$filter,User,ajaxPost,notifier){$scope.today=new Date;var handleError=function(reason){reason instanceof Object?(notifier.error($filter("titleCase")(reason.name)),$scope.mongooseErrors=reason.errors):notifier.error(reason)};$http({method:"get",cache:!0,url:"/api/roles"}).success(function(data){$scope.roles=data}).error(function(err){console.log(err)}),$http({method:"get",url:"/api/libraries"}).success(function(data){$scope.libraries=data}).error(function(err){console.log(err)}),$http({method:"get",cache:!0,url:"/api/countries"}).success(function(data){$scope.countries=data}).error(function(err){console.log(err)}),$scope.upload=!1,$scope.newLibrary=!1,$scope.addNewLibrary=function(){$scope.library=new Object({librarians:[$scope.user._id]}),$scope.newLibrary=!0},$scope.removeNewLibrary=function(){$scope.library=void 0,$scope.newLibrary=!1},$scope.addUserAsAdmin=function(user){$scope.newLibrary===!0?User.addAsAdmin(user,$scope.library,!0).then(function(){$location.path("/admin/users")},function(reason){handleError(reason)}):user.ownLibraryID?User.addAsAdmin(user,user.ownLibraryID,!1).then(function(){$location.path("/admin/users")},function(reason){handleError(reason)}):User.addAsAdmin(user).then(function(){$location.path("/admin/users")},function(reason){handleError(reason)})},$scope.setFileEventListener=function(element,field){"avatar"===field?($scope.uploadedAvatar=element.files[0],$scope.uploadedAvatar&&$scope.$apply(function(){$scope.uploadAvatarButtonState=!0})):"certificate"===field&&($scope.uploadedCertificate=element.files[0],$scope.uploadedCertificate&&$scope.$apply(function(){$scope.uploadCertificateButtonState=!0}))},$scope.uploadFile=function(field){if("avatar"===field){if(!$scope.uploadedAvatar)return;ajaxPost.uploadFileInit($scope.uploadedAvatar).then(function(result){200===result.status&&($scope.user.avatar=result.data,$scope.avatarUploadSuccessful=!0,$scope.avatarUploadError=!1,$scope.avatarTypeError=!1)},function(error){"Invalid mime type"===error.data?$scope.avatarTypeError=!0:$scope.avatarUploadError=!0,$scope.avatarError=error.data})}else{if(!$scope.uploadedCertificate)return;ajaxPost.uploadFileInit($scope.uploadedCertificate).then(function(result){200===result.status&&($scope.library.certificate=result.data,$scope.certificateUploadSuccessful=!0,$scope.certificateUploadError=!1,$scope.certificateTypeError=!1)},function(error){"Invalid mime type"===error.data?$scope.certificateTypeError=!0:$scope.certificateUploadError=!0,$scope.certificateError=error.data})}}}),app.controller("EditProfileAdminCtrl",function($scope,$location,$routeParams,$http,$filter,User,ajaxPost,UserResource,notifier){$scope.today=new Date;var handleError=function(reason){reason instanceof Object?(notifier.error($filter("titleCase")(reason.name)),$scope.mongooseErrors=reason.errors):notifier.error(reason)};$scope.user=UserResource.get({id:$routeParams.id},function(data){data||$location.path("/404")},function(){$location.path("/404")}),$scope.updateAsAdmin=function(user){-1!==user.roles.indexOf("librarian")||-1!==user.roles.indexOf("libraryOwner")?$scope.newLibrary===!0?User.updateAsAdmin(user,$scope.library,!0).then(function(){$location.path("/admin/users")}):user.hasOwnProperty("ownLibraryID")&&""!==user.hasOwnProperty?User.updateAsAdmin(user,user.ownLibraryID,!1).then(function(){$location.path("/admin/users")},function(reason){handleError(reason)}):User.updateAsAdmin(user).then(function(){$location.path("/admin/users")},function(reason){handleError(reason)}):(user.ownLibraryID="",User.updateAsAdmin(user).then(function(){$location.path("/admin/users"),notifier.success("User "+user.username+" updated!")},function(reason){console.log(reason),handleError(reason)}))},$http({method:"get",cache:!0,url:"/api/roles"}).success(function(data){$scope.roles=data}).error(function(err){console.log(err)}),$http({method:"get",url:"/api/libraries"}).success(function(data){$scope.libraries=data,$scope.libraryObject=$scope.user.ownLibraryID}).error(function(err){console.log(err)}),$http({method:"get",cache:!0,url:"/api/countries"}).success(function(data){$scope.countries=data}).error(function(err){console.log(err)}),$scope.newLibrary=!1,$scope.selectLibrary=function(){$scope.user.ownLibraryID=$scope.libraryObject},$scope.addNewLibrary=function(){$scope.library=new Object({librarians:[$scope.user._id]}),$scope.newLibrary=!0},$scope.removeNewLibrary=function(){$scope.library=void 0,$scope.newLibrary=!1},$scope.upload=!1,$scope.setFileEventListener=function(element,field){"avatar"===field?($scope.uploadedAvatar=element.files[0],$scope.uploadedAvatar&&$scope.$apply(function(){$scope.uploadAvatarButtonState=!0})):"certificate"===field&&($scope.uploadedCertificate=element.files[0],$scope.uploadedCertificate&&$scope.$apply(function(){$scope.uploadCertificateButtonState=!0}))},$scope.uploadFile=function(field){if("avatar"===field){if(!$scope.uploadedAvatar)return;ajaxPost.uploadFileInit($scope.uploadedAvatar).then(function(result){200===result.status&&($scope.user.avatar=result.data,$scope.avatarUploadSuccessful=!0,$scope.avatarUploadError=!1,$scope.avatarTypeError=!1)},function(error){console.log(error),"Invalid mime type"===error.data?$scope.avatarTypeError=!0:$scope.avatarUploadError=!0,$scope.avatarError=error.data})}else{if(!$scope.uploadedCertificate)return;ajaxPost.uploadFileInit($scope.uploadedCertificate).then(function(result){200===result.status&&($scope.library.certificate=result.data,$scope.certificateUploadSuccessful=!0,$scope.certificateUploadError=!1,$scope.certificateTypeError=!1)},function(error){"Invalid mime type"===error.data?$scope.certificateTypeError=!0:$scope.certificateUploadError=!0,$scope.certificateError=error.data})}}}),app.controller("UserDeleteCtrl",function($scope,$routeParams,$http,$location,notifier){$http.get("/api/user/delete/"+$routeParams.id).success(function(){notifier.success("The user has been successfully deleted.")}),$location.path("/admin/users")}),app.controller("UserInfoCtrl",function($scope,$location,$http,UserResource,$routeParams,$timeout,notifier,LibraryResource,FavoriteBookResource,UserReadingProfileResource,UserBookingsResource){$scope.user=UserResource.get({id:$routeParams.id},function(data){data?(data.dateOfBirth=data.dateOfBirth||"N/A",data.facebookUrl=data.facebookUrl||"N/A",data.twitterUrl=data.twitterUrl||"N/A",data.googlePlusUrl=data.googlePlusUrl||"N/A",data.aboutMe=data.aboutMe||"N/A"):$location.path("/404"),data.libraries=[],data.readings=UserReadingProfileResource.get({userID:data._id}),data.bookings=UserBookingsResource.get({userID:data._id});for(var lib=0;lib<data.librarySubscriptions.length;lib++)data.libraries[lib]=LibraryResource.get({id:data.librarySubscriptions[lib]})},function(){$location.path("/404")}),$scope.favoriteBooks=FavoriteBookResource.get({userID:$routeParams.id})}),app.controller("UserListCtrl",function($scope,UsersResourceSortable,$routeParams,$http){$scope.page=1,$scope.perPage=10,$scope.field="_id",$scope.order="asc",$scope.range=function(n){return new Array(n)},$scope.pages=function(){$http.get("/api/users/count").success(function(data){$scope.usersCount=parseInt(data),$scope.pagesCount=Math.ceil($scope.usersCount/$scope.perPage)})},$scope.users=UsersResourceSortable.query({field:$scope.field,order:$scope.order,page:$scope.page,perPage:$scope.perPage}),$scope.setPage=function(page,event){$scope.page=page,console.log(page),angular.element(".pagination li").removeClass("active"),angular.element("#"+event.target.id).parent().addClass("active")},$scope.setPerPage=function(perPage){$scope.perPage=perPage},$scope.sort=function(event){$scope.field=event.target.id,$scope.order=$scope.order="asc"===$scope.order?"desc":"asc"},$scope.reloadUsers=function(){$scope.users=UsersResourceSortable.query({field:$scope.field,order:$scope.order,page:$scope.page,perPage:$scope.perPage})}}),app.controller("BookDetailsCtrl",function($scope,$routeParams,uiGmapGoogleMapApi,identity,Socket,$http,$route,$compile,LibraryUsersInteractions,notifier,$location,$anchorScroll,BookResource,LibraryReadingResource,LibBookResource,LibraryBook,$window,LibraryResource,Book){function calculateDistance(lat1,lon1,lat2,lon2){var R=6371,dLat=degreesToRadians(lat2-lat1),dLon=degreesToRadians(lon2-lon1),lat1=degreesToRadians(lat1),lat2=degreesToRadians(lat2),a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.sin(dLon/2)*Math.sin(dLon/2)*Math.cos(lat1)*Math.cos(lat2),c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),d=R*c;return d}function degreesToRadians(value){return value*Math.PI/180}if($scope.user=identity.currentUser,$scope.showMore=!0,$scope.book=BookResource.get({id:$routeParams.id},function(data){data||$location.path("/404")}),$scope.gotoOtherLibraries=function(){$location.hash("other"),$anchorScroll()},$scope.downloadEbook=function(){console.log($scope.book.ebookUrl),$http({url:"/api/book/ebook/",method:"GET",params:{path:$scope.book.ebookUrl},headers:{"Content-type":"application/epub+zip"},responseType:"arraybuffer"}).success(function(data){var blob=new Blob([data],{type:"application/epub+zip"}),objectUrl=URL.createObjectURL(blob),element=angular.element("<a/>");element.attr({href:objectUrl,target:"_blank",download:$scope.book.title+".epub"})[0].click()}).error(function(err){console.log(err),notifier.error(err.reason||err)})},$http.get("/api/library/lib-books/"+$routeParams.id).success(function(data){uiGmapGoogleMapApi.then(function(){$scope.libraries=[],$scope.randomMarkers=[],$window.navigator.geolocation?$window.navigator.geolocation.getCurrentPosition(function(success){$scope.map={center:{latitude:success.coords.latitude,longitude:success.coords.longitude},zoom:12};var marker={latitude:success.coords.latitude,longitude:success.coords.longitude,icon:"../../dist/images/pinkmarker.png",id:0,options:{animation:1}};$scope.randomMarkers.push(marker);for(var closestLibraryIndex,minDistance=Number.MAX_VALUE,i=0;i<data.length;i++)LibraryResource.get({id:data[i].libraryID},function(data){$scope.libraries.push(data),$scope.libraries[$scope.libraries.length-1].distance=calculateDistance(success.coords.latitude,success.coords.longitude,$scope.libraries[$scope.libraries.length-1].address.geometry.location.lat,$scope.libraries[$scope.libraries.length-1].address.geometry.location.lng),$scope.libraries[$scope.libraries.length-1].distance<minDistance&&(minDistance=$scope.libraries[$scope.libraries.length-1].distance,closestLibraryIndex=$scope.libraries.length-1);var marker={latitude:$scope.libraries[$scope.libraries.length-1].address.geometry.location.lat,longitude:$scope.libraries[$scope.libraries.length-1].address.geometry.location.lng,icon:"../../dist/images/bluemarker.png",id:$scope.libraries.length,showWindow:!0,options:{labelContent:$scope.libraries[$scope.libraries.length-1].name,labelClass:"marker-labels",labelAnchor:"24 4"}};$scope.randomMarkers.push(marker),$scope.libraries.length===i&&($scope.randomMarkers[closestLibraryIndex+1].icon="../../dist/images/greenmarker.png")})},function(){for(var i=0;i<data.length;i++)LibraryResource.get({id:data[i].libraryID},function(data){$scope.libraries.push(data);var marker={latitude:$scope.libraries[$scope.libraries.length-1].address.geometry.location.lat,longitude:$scope.libraries[$scope.libraries.length-1].address.geometry.location.lng,icon:"../../dist/images/bluemarker.png",id:$scope.libraries.length,showWindow:!0,options:{labelContent:$scope.libraries[$scope.libraries.length-1].name,labelClass:"marker-labels",labelAnchor:"24 4"}};$scope.randomMarkers.push(marker),$scope.libraries.length===i&&($scope.map={center:{latitude:$scope.libraries[0].address.geometry.location.lat,longitude:$scope.libraries[0].address.geometry.location.lng},zoom:8})})}):console.log("Geolocation is not supported by this browser.")})}).error(function(err){notifier.error(err)}),"undefined"!=typeof $routeParams.libraryID){$scope.libraryID=$routeParams.libraryID,$scope.readers=LibraryReadingResource.get({libraryID:$scope.libraryID}),$scope.libBook=LibBookResource.get({libraryID:$scope.libraryID,bookID:$routeParams.id}),$scope.library=LibraryResource.get({id:$scope.libraryID}),$scope.available=!1,$scope.isFavorite=!1;var url="/api/library/booking/"+$scope.libraryID+"/"+$routeParams.id;console.log(url),$http.get(url).success(function(data){if(console.log(data),$scope.bookings=data,"undefined"==typeof $scope.user)$scope.isMember=!1;else{$scope.isMember="undefined"!=typeof $scope.user.librarySubscriptions&&$scope.user.librarySubscriptions.indexOf($scope.libraryID)>-1?!0:!1,$http.get("/api/book/availabilitySubscription/"+$routeParams.id+"/"+$routeParams.libraryID+"/"+$scope.user._id).success(function(data){$scope.subscribedForAvailability=data}).error(function(err){console.log(err),$scope.subscribedForAvailability=!1});var flag=!1;console.log($scope.bookings);for(var i=0;i<$scope.bookings.length;i++)if($scope.bookings[i].userID===$scope.user._id){flag=!0,$scope.available=!1,$scope.booking=$scope.bookings[i],$scope.reservationEnd=$scope.bookings[i].bookDate,console.log($scope.reservationEnd);var wrapper=angular.element(document.querySelector("#timerWrapper"));wrapper.append('<timer class="text-center" end-time="reservationEnd"><p>Your reservation ends after:</p><p class="text-info">{{days}} day, {{hours}} hours, {{minutes}} minutes and {{seconds}} seconds</p></timer>'),$compile(wrapper)($scope);break}flag||(Socket.on($routeParams.id,function(action){"decrease"===action?$scope.libBook.available--:"increase"===action&&($scope.libBook.available++,$scope.subscribedForAvailability===!0&&($scope.subscribedForAvailability=!1)),$scope.available=$scope.libBook.available-$scope.bookings.length>0&&$scope.isMember?!0:!1}),$scope.available=$scope.libBook.available-$scope.bookings.length>0&&$scope.isMember?!0:!1),$http.get("/api/book/isFavorite/"+identity.currentUser._id+"/"+$routeParams.id).success(function(data){$scope.isFavorite=data?!0:!1})}})}$scope.addBooking=function(){var booking=new Object({}),checkDay=new Date((new Date).getTime()+864e5),workingDays=$scope.library.workdays,workingHoursStr=$scope.library.workhours,workingHours=[];workingHoursStr.forEach(function(element,index){if(null!==element){var currentDay=[],currentSplit=element.split("-"),openingSplit=currentSplit[0],closingSplit=currentSplit[1];openingSplit=openingSplit.split(":"),openingSplit=openingSplit[0],closingSplit=closingSplit.split(":"),closingSplit=closingSplit[0],currentDay.push(openingSplit),currentDay.push(closingSplit),workingHours[index]=currentDay}});for(var todayWeekDay=checkDay.getDay(),initialDay=checkDay.getDay(),add=0;workingDays[todayWeekDay]!==!0&&(todayWeekDay++,todayWeekDay!==initialDay);)7===todayWeekDay&&(todayWeekDay=0,add=!0);var workingHoursIndex=todayWeekDay,newBookingDate=new Date;newBookingDate=new Date(add===!0?checkDay.getTime()+864e5*(Math.abs(7-initialDay)+(Math.abs(0-todayWeekDay)+1)):checkDay.getTime()+864e5*(Math.abs(todayWeekDay-initialDay)+add)),newBookingDate.setHours(workingHours[workingHoursIndex][1]),newBookingDate.setMinutes(0),newBookingDate.setSeconds(0),booking.userID=identity.currentUser._id,booking.userName=identity.currentUser.username,booking.libraryID=$scope.libraryID,booking.libraryName=$scope.library.name,booking.bookID=$routeParams.id,booking.bookName=$scope.book.title,booking.bookDate=newBookingDate,LibraryUsersInteractions.addBooking(booking).then(function(){notifier.success("Booking added successfully!"),$route.reload()},function(err){notifier.error(err.data)})},$scope.removeBooking=function(){LibraryUsersInteractions.removeBooking($scope.booking).then(function(){notifier.success("Booking removed successfully!"),$route.reload()},function(err){notifier.error(err.data)})},$scope.addFavorite=function(bookName,bookISBN){var favorite=new Object({});favorite.bookID=$routeParams.id,favorite.bookISBN=bookISBN,favorite.libraryID=$scope.libraryID,favorite.bookName=bookName,favorite.userID=identity.currentUser._id,Book.addFavorite(favorite).then(function(){notifier.success("Book added successfully to favorites!"),$scope.isFavorite=!0})},$scope.removeFavorite=function(){var responsePromise=$http.get("/api/book/deleteFavorite/"+identity.currentUser._id+"/"+$routeParams.id+"/"+$routeParams.libraryID);responsePromise.success(function(){notifier.success("You've removed this book from favorites successfully!"),$scope.isFavorite=!1}).error(function(reason){notifier.error(reason)})},$scope.subscribeForAvailabilityNotification=function(){var subscription={userID:$scope.user._id,libraryID:$routeParams.libraryID,bookID:$routeParams.id};LibraryBook.subscribeForAvailabilityNotification(subscription).then(function(){notifier.success("You will be notified when the book is available!"),$scope.subscribedForAvailability=!0}).error(function(reason){notifier.error(reason)})},$scope.unsubscribeForAvailabilityNotification=function(){$http.delete("/api/book/availabilitySubscription/"+$routeParams.id+"/"+$routeParams.libraryID+"/"+$scope.user._id).success(function(data){notifier.success("Your subscription was deleted!"),$scope.subscribedForAvailability=!1,console.log(data)}).error(function(err){console.log(err)})}}),app.controller("SearchCtrl",function($scope,$location,$routeParams,$http,BookSearchResource){$scope.showResults=!1,$scope.search=function(phrase){return"undefined"!=typeof phrase&&" "!==phrase&&""!==phrase?($scope.phrase=phrase,BookSearchResource.query({phrase:phrase,limit:4},function(results){if($scope.results=results,0===$scope.results.length)$scope.showResults=!1;else{$scope.showResults=!0;var lastResult={message:"See more results for '"+phrase+"'"};$scope.results.push(lastResult)}})):($scope.results=void 0,void($scope.showResults=!1))},$scope.goToResult=function(item){$scope.result.selected=void 0,$location.path(item.hasOwnProperty("message")?"/search/"+$scope.phrase:"/book/"+item._id)},void 0!==$routeParams.phrase&&($scope.phrase=$routeParams.phrase,$scope.books=BookSearchResource.query({phrase:$routeParams.phrase,limit:10})),$scope.hideResults=function(){$scope.results=void 0}}),app.controller("CatalogCtrl",function($scope,BookResourceFilterable,$routeParams,$http){$scope.page=1,$scope.perPage=10,$scope.field="uploaded",$scope.order="desc",$scope.criteria="all",$scope.phrase=" ",$scope.libraryID=$routeParams.id||"all",$scope.books=BookResourceFilterable.query({libraryID:$scope.libraryID}),$scope.range=function(n){return new Array(n)},$scope.pages=function(){if(" "===$scope.phrase){var url=$routeParams.id?"/api/book/count/"+$routeParams.id:"/api/book/count";$http.get(url).success(function(data){$scope.booksCount=parseInt(data),$scope.pagesCount=Math.ceil($scope.booksCount/$scope.perPage)})}else $http.get("/api/book/countFilter/"+$scope.field+"/"+$scope.order+"/"+$scope.page+"/"+$scope.perPage+"/"+$scope.criteria+"/"+$scope.phrase+"/"+$scope.libraryID).success(function(data){$scope.booksCount=parseInt(data),$scope.pagesCount=Math.ceil($scope.booksCount/$scope.perPage)})},$scope.pages(),$scope.setPage=function(page,event){var newPage=page||"1";if(newPage!==$scope.page){$scope.page=page||"1",angular.element(".pagination li").removeClass("active");var target=event?"#"+event.target.id:"#page-1";angular.element(target).parent().addClass("active")}},$scope.sort=function(event){$scope.field=event.target.id,$scope.order=$scope.order="asc"===$scope.order?"desc":"asc"},$scope.reloadBooks=function(){""===$scope.phrase&&($scope.phrase=" "),$scope.books=BookResourceFilterable.query({field:$scope.field,order:$scope.order,page:$scope.page,perPage:$scope.perPage,criteria:$scope.criteria,phrase:$scope.phrase,libraryID:$scope.libraryID})}}),app.controller("LibrariesListCtrl",function($scope,$window,cachedLibraries,notifier){function calculateDistance(lat1,lon1,lat2,lon2){var R=6371,dLat=degreesToRadians(lat2-lat1),dLon=degreesToRadians(lon2-lon1),lat1=degreesToRadians(lat1),lat2=degreesToRadians(lat2),a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.sin(dLon/2)*Math.sin(dLon/2)*Math.cos(lat1)*Math.cos(lat2),c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),d=R*c;return d}function degreesToRadians(value){return value*Math.PI/180}cachedLibraries.query().then(function(data){$scope.libraries=data,$window.navigator.geolocation?$window.navigator.geolocation.getCurrentPosition(function(success){for(var i=0;i<$scope.libraries.length;i++)$scope.libraries[i].distance=calculateDistance(success.coords.latitude,success.coords.longitude,$scope.libraries[i].address.geometry.location.lat,$scope.libraries[i].address.geometry.location.lng);$scope.$apply()},function(err){console.log(err)}):console.log("Geolocation is not supported by this browser.")},function(reason){notifier.error(reason)}),$scope.sort="distance"}),app.controller("LibraryDetailsCtrl",function($scope,$location,User,$routeParams,$route,uiGmapGoogleMapApi,BookResource,cachedLibraries,LibBooksResource,UserReadingResource,identity,$http,LibraryUsers,notifier,$window){if($scope.user=identity.currentUser,$scope.library=cachedLibraries.query().then(function(collection){var found=!1;collection.every(function(library){return library._id===$routeParams.id?($scope.library=library,uiGmapGoogleMapApi.then(function(){$scope.map={center:{latitude:library.address.geometry.location.lat,longitude:library.address.geometry.location.lng},zoom:16},$scope.marker={coords:{latitude:library.address.geometry.location.lat,longitude:library.address.geometry.location.lng},idkey:0,icon:"../../dist/images/bluemarker.png",options:{animation:1,labelContent:library.name,labelClass:"marker-labels",labelAnchor:"24 4"}}}),found=!0,!1):!0}),found||$location.path("/404")}),$http.get("/api/library/user-count/"+$routeParams.id).success(function(data){$scope.membersCount=data}),$scope.libBooks=LibBooksResource.query({id:$routeParams.id},function(){$scope.booksCount=0,$scope.books=[];for(var i=0;i<$scope.libBooks.length;i++)$scope.booksCount+=$scope.libBooks[i].total,$scope.books[i]=BookResource.get({id:$scope.libBooks[i].bookID},function(){})}),void 0===identity.currentUser)$scope.isMember=!1,$scope.isLoggedIn=!1;else{var responsePromise=$http.get("/api/library/member/"+$routeParams.id+"/"+identity.currentUser._id);responsePromise.success(function(data){console.log(data),$scope.isMember=data?!0:!1}),console.log($scope.isMember),$scope.isLoggedIn=!0}$scope.readings=void 0===identity.currentUser?[]:UserReadingResource.query({userID:identity.currentUser._id,libraryID:$routeParams.id}),$scope.subscribeForLibrary=function(){identity.currentUser.given=0,identity.currentUser.toReturn=0,identity.currentUser.userID=identity.currentUser._id,LibraryUsers.addUserToLibrary(identity.currentUser,$routeParams.id,$scope.library.paid).then(function(data){$scope.library.paid===!1?(notifier.success("You've subscribed successfully!"),$route.reload()):(console.log("/api/payment/create/paypal/"+$scope.library.amount+"/USD/subscription/"+data._id),$window.location.href="/api/payment/create/paypal/"+$scope.library.amount+"/USD/subscription/"+data._id)},function(reason){notifier.error(reason)})},$scope.unsubscribeForLibrary=function(){var responsePromise=$http.get("/api/library/delete-user/"+identity.currentUser._id+"/"+$routeParams.id);responsePromise.success(function(){$scope.user.librarySubscriptions.splice($scope.user.librarySubscriptions.indexOf($routeParams.id),1),User.update($scope.user).then(function(){notifier.success("You've unsubscribed successfully!"),$route.reload()},function(reason){notifier.error(reason)})}).error(function(reason){notifier.error(reason)})}}),app.controller("LibraryAddBookCtrl",function($scope,$http,$location,$anchorScroll,$filter,Book,bookSearch,identity,notifier,ajaxPost,LibBookResource,LibraryResource){$scope.displayForm=!1,$scope.today=new Date;var handleError=function(reason){reason instanceof Object?(notifier.error($filter("titleCase")(reason.data.reason.name)),$scope.mongooseErrors=reason.data.reason.errors):notifier.error(reason)};$http({method:"get",cache:!0,url:"/api/genres"}).success(function(data){$scope.genres=data}).error(function(err){console.log(err)}),$scope.uploadEbook=function(index){var fd=new FormData;fd.append("file",$scope.uploadedFile),$http.post("/api/books/upload",fd,{withCredentials:!0,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(data){$scope.books[index].ebookUrl=data,$scope.ebookUploadSuccess="Ebook successfully uploaded",$scope.ebookUploadError=void 0,console.log(data)}).error(function error(error){error.reason&&(console.log(error),$scope.ebookUploadError=error.reason.name||error.reason,$scope.ebookUploadSuccess=void 0)
})},$scope.page=1,$scope.perPage=3,$scope.field="_id",$scope.library=LibraryResource.get({id:identity.currentUser.ownLibraryID}),$scope.range=function(n){return new Array(n)},$scope.getPagesCount=function(){return $scope.booksCount=$scope.books.length,$scope.pagesCount=Math.ceil($scope.booksCount/$scope.perPage),$scope.pagesCount},$scope.setPage=function(page,event){$scope.page=page,$anchorScroll(),angular.element(".pagination li").removeClass("active"),angular.element("#"+event.target.id).parent().addClass("active")},$scope.setPerPage=function(perPage){$scope.perPage=perPage};var fieldsOptions=[],fieldsOptionsCopy=[];$scope.fields=[],$scope.matches=[],$http({method:"get",cache:!0,url:"/api/books/fields/true"}).success(function(data){fieldsOptions=data,fieldsOptionsCopy=fieldsOptions;for(var i=0;20>i;i++)$scope.fields.push(fieldsOptions)}).error(function(err){console.log(err)}),$scope.updateSelections=function(key,value){value="quantity"===value.toString()?"total":value,$scope.matches[key]=value;for(var i=0;i<Object.keys($scope.result[0]).length;i++){$scope.fields[i]=[];for(var j=0;j<fieldsOptionsCopy.length;j++)$scope.matches.indexOf(fieldsOptionsCopy[j])<0&&$scope.fields[i].push(fieldsOptionsCopy[j])}$scope.matches.forEach(function(element,index){$scope.fields[index].push(element)})},$scope.showCSVForms=function(includeTopRow,sheet,notDisplayingForm){$scope.books=[];for(var len=sheet&&$scope.result.sheets[sheet].data.length||$scope.result.length,i=includeTopRow?0:1;len>i;i++){for(var book={},j=0;j<fieldsOptions.length;j++)"undefined"!=typeof $scope.matches[j]&&(book[$scope.matches[j]]=sheet?$scope.result.sheets[sheet].data[i][j]:$scope.result[i][j]);$scope.books.push(book)}notDisplayingForm||($scope.displayForm=!0,$anchorScroll())},$scope.importAll=function(includeTopRow,sheet){for(var results=sheet?$scope.result.sheets[sheet].data[0]:$scope.result[0],matches={},i=0;i<$scope.matches.length;i++)"undefined"!=typeof $scope.matches[i]&&(matches[$scope.matches[i]]=results[i]);matches=JSON.stringify(matches);var fd=new FormData;fd.append("file",$scope.file),fd.append("matches",matches),fd.append("topRow",includeTopRow),fd.append("sheet",sheet),$scope.loading=!0,$http.post("/api/library/books/import/"+$scope.library._id,fd,{withCredentials:!0,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(data){console.log(data),notifier.success("All books were added successfully"),$location.path("/library-panel/books-library")}).error(function error(error){console.log(error),error.reason&&notifier.error(error.reason),(error.failed||error.isbnExists)&&($scope.books=error.failed,$scope.isbnExists=error.isbnExists,$scope.displayForm=!0,notifier.error("Some books were not added. Please check all fields"),$anchorScroll())}).finally(function(){$scope.loading=!1})},$scope.removeBookForm=function(index){$scope.books.splice(index,1),notifier.success("Book Form removed successfully!"),$scope.books.length<1&&($scope.displayForm=!1,$scope.csv=!1,$scope.searchState=void 0)},$scope.addBook=function(book,index){Book.add(book,identity.currentUser.ownLibraryID).then(function(){notifier.success("Book added successfully!"),"undefined"!=typeof $scope.books&&$scope.books.splice(index,1),("undefined"!=typeof $scope.book||$scope.books.length<1)&&$location.path("/library-panel/books-library")},function(reason){handleError(reason)})},$scope.newForm=function(){$scope.books=[],$scope.books[0]=new Object({}),$scope.displayForm=!0,$scope.searchState=void 0},$scope.findBook=function(){$scope.searchState=void 0,$scope.found=void 0,$scope.existInLibrary=void 0,angular.element("#searchByIsbnButton").trigger("click");var bookPromise=bookSearch.search($scope.ISBNSearch);bookPromise.then(function(data){console.log(data),data.foundInDatabase?LibBookResource.get({bookID:data._id,libraryID:$scope.library._id},function(book){$scope.existInLibrary=!0,$scope.libBook=book,angular.element("#searchByIsbn").select(),$scope.found=!1,$scope.searchState=!1},function(err){404===err.status?$scope.book=data:notifier.error(err.data)}):($scope.books=[],data.isbn=$scope.ISBNSearch.replace(/-/gi,""),"undefined"!=typeof data.themes&&"undefined"!=typeof $scope.library.librarySections&&data.themes.forEach(function(theme){$scope.library.librarySections.sectionsTheme.indexOf(theme)>-1&&(data.section=$scope.library.librarySections.sectionsTheme.indexOf(theme)+1)}),$scope.books[0]=data,$scope.displayForm=!0,$scope.searchState=!0)},function(){angular.element("#searchByIsbn").select(),$scope.searchState=!1,$scope.found=!1})},$scope.setFileEventListener=function(element){"undefined"==typeof $scope.books&&($scope.books[0]=new Object({})),$scope.uploadedFile=element.files[0],$scope.uploadedFile&&$scope.$apply(function(){$scope.uploadButtonState=!0})},$scope.uploadFile=function(index){$scope.uploadedFile&&ajaxPost.uploadFileInit($scope.uploadedFile).then(function(result){200===result.status&&($scope.books[index].cover=result.data,$scope.coverUploadSuccessful=!0,$scope.coverUploadError=!1,$scope.coverTypeError=!1)},function(error){"Invalid mime type"===error.data?$scope.coverTypeError=!0:$scope.coverUploadError=!0,$scope.coverError=error.data})}}),app.controller("BookInfoLibCtrl",function($scope,LibBookResource2,BookResource,$routeParams,$location){$scope.showMore=!0,$scope.libraryBook=LibBookResource2.get({id:$routeParams.id},function(data){data?$scope.book=BookResource.get({id:$scope.libraryBook.bookID},function(data){data||$location.path("/404")},function(){$location.path("/404")}):$location.path("/404")},function(){$location.path("/404")})}),app.controller("EditBookLibraryCtrl",function($scope,$location,$filter,LibraryBook,notifier,LibBookResource2,BookResource,LibraryResource,$routeParams){var handleError=function(reason){reason instanceof Object?(notifier.error($filter("titleCase")(reason.name)),$scope.mongooseErrors=reason.errors):notifier.error(reason)};$scope.libraryBook=LibBookResource2.get({id:$routeParams.id},function(data){data?($scope.book=BookResource.get({id:$scope.libraryBook.bookID}),$scope.library=LibraryResource.get({id:$scope.libraryBook.libraryID})):$location.path="/404"},function(){$location.path("/404")}),$scope.updateLibBookAsLibrarian=function(updatedLibraryBook){updatedLibraryBook.available=updatedLibraryBook.total-updatedLibraryBook.given,console.log($scope.backUpBook),LibraryBook.update(updatedLibraryBook).then(function(){notifier.success("'"+updatedLibraryBook.bookName+"' successfully updated!"),$location.path("/library-panel/books-library")},function(reason){handleError(reason)})}}),app.controller("LibraryBookDeleteCtrl",function($scope,$routeParams,$http,$location,notifier){$http.get("/api/book/delete2/"+$routeParams.id).success(function(data){data?notifier.success("The book has been successfully deleted."):$location.path("/404")}),$location.path("/library-panel/books-library")}),app.controller("LibraryBooksListCtrl",function($scope,LibBooksResource,LibBooksSectionResource,$routeParams,$http,identity,LibBooksResourceSortable){$scope.user=identity.currentUser,$scope.page=1,$scope.perPage=10,$scope.field="published",$scope.order="asc",$scope.range=function(n){return new Array(n)},$scope.pages=function(){$http.get("/api/bookCount/"+$scope.user.ownLibraryID).success(function(data){$scope.booksCount=parseInt(data),$scope.pagesCount=Math.ceil($scope.booksCount/$scope.perPage)})},$scope.books=void 0!==$routeParams.section?LibBooksSectionResource.query({libraryID:$scope.user.ownLibraryID,section:$routeParams.section}):LibBooksResource.query({id:$scope.user.ownLibraryID}),$scope.setPage=function(page,event){$scope.page=page,angular.element(".pagination li").removeClass("active"),angular.element("#"+event.target.id).parent().addClass("active")},$scope.setPerPage=function(perPage){$scope.perPage=perPage},$scope.sort=function(event){$scope.field=event.target.id,$scope.order=$scope.order="asc"===$scope.order?"desc":"asc"},$scope.reloadBooks=function(){$scope.books=LibBooksResourceSortable.query({field:$scope.field,order:$scope.order,page:$scope.page,perPage:$scope.perPage,id:$scope.user.ownLibraryID})}}),app.controller("FineDeleteFromLibraryCtrl",function($scope,$routeParams,$http,$location,notifier){$http.get("/api/library/fine-remove/"+$routeParams.id).success(function(){notifier.success("The fine has been successfully removed")}).error(function(){notifier.error("The fine wasn't removed! Please try again later!")}),$location.path("/library-panel/fines")}),app.controller("FinePaidLibraryCtrl",function($scope,$routeParams,$http,$location,notifier){$http.get("/api/library/fine-paid/"+$routeParams.id).success(function(){notifier.success("The fine was paid successfully.")}).error(function(){notifier.error("The fine wasn't paid! Please try again later!")}),$location.path("/library-panel/fines")}),app.controller("LibraryAddFineCtrl",function($scope,$routeParams,$location,identity,notifier,Fine,UserResource){$scope.finedUserInfo=UserResource.get({id:$routeParams.userID},function(){},function(){$location.path("/library-panel/fines")}),$scope.addFine=function(fine){var fineObject={amount:fine.amount,reason:fine.reason,userID:$scope.finedUserInfo._id,username:$scope.finedUserInfo.username,libraryID:identity.currentUser.ownLibraryID};Fine.add(fineObject).then(function(){notifier.success("Fine added successfully!"),$location.path("/library-panel/fines")},function(){$location.path("/library-panel/fines")})}}),app.controller("LibraryFinesListCtrl",function($scope,$routeParams,$http,identity,LibFinesResourceSortable){$scope.user=identity.currentUser,$scope.page=1,$scope.perPage=10,$scope.field="added",$scope.order="asc",$scope.range=function(n){return new Array(n)},$scope.pages=function(){$http.get("/api/finesInLibraryCount/"+$scope.user.ownLibraryID).success(function(data){console.log(data),$scope.finesCount=parseInt(data),$scope.pagesCount=Math.ceil($scope.finesCount/$scope.perPage)})},$scope.fines=LibFinesResourceSortable.query({field:$scope.field,order:$scope.order,page:$scope.page,perPage:$scope.perPage,libraryID:$scope.user.ownLibraryID}),$scope.setPage=function(page,event){$scope.page=page,angular.element(".pagination li").removeClass("active"),angular.element("#"+event.target.id).parent().addClass("active")},$scope.setPerPage=function(perPage){$scope.perPage=perPage},$scope.sort=function(event){$scope.field=event.target.id,$scope.order=$scope.order="asc"===$scope.order?"desc":"asc"},$scope.reloadFines=function(){$scope.fines=LibFinesResourceSortable.query({field:$scope.field,order:$scope.order,page:$scope.page,perPage:$scope.perPage,libraryID:$scope.user.ownLibraryID})}}),app.controller("LibraryPanelCtrl",function($scope,identity,$location,$http){$scope.identity=identity,$scope.path=$location.path(),$scope.menu=[{name:"books",links:{add:"/library-panel/books/add",browse:"/library-panel/books-library"}},{name:"users",links:{browse:"/library-panel/users","book reservations":"/library-panel/users/book-reservations","books taken":"/library-panel/users/books-taken","library visits":"/library-panel/users/visits"}},{name:"fines",links:{browse:"/library-panel/fines"}}],$scope.getCurrentMenuItem=function(path){for(var i=0;i<$scope.menu.length;i++)for(var key in $scope.menu[i].links)if($scope.menu[i].links[key]===path)return $scope.menu[i].name;return""},$scope.currentMenuItem=$scope.getCurrentMenuItem($scope.path),$http.get("/api/library/late-readings").success(function(){console.log("fined")}).error(function(data){console.log("error: "+data)})}),app.controller("LibrarySettingsCtrl",function($scope,$http,identity,$window,$filter,Library,User,notifier,UserResource,ajaxPost,LibraryResource){$scope.currentLibrarians=[],$scope.refreshAddresses=function(address){var params={address:address,sensor:!1};return $http.get("http://maps.googleapis.com/maps/api/geocode/json",{params:params}).then(function(response){$scope.addresses=response.data.results})},$scope.library=LibraryResource.get({id:identity.currentUser.ownLibraryID},function(data){$scope.library.workHoursClosingMinutes=[],$scope.library.workHoursOpeningHour=[],$scope.library.workHoursOpeningMinutes=[],$scope.library.workHoursClosingHour=[];for(var i=0;7>i;i++)if(data.workdays[i]===!0){var daySchedule=data.workhours[i];$scope.library.workHoursOpeningHour[i]=parseInt(daySchedule.substring(0,daySchedule.indexOf(":"))),$scope.library.workHoursOpeningMinutes[i]=parseInt(daySchedule.substring(daySchedule.indexOf(":")+1,daySchedule.indexOf("-"))),$scope.library.workHoursClosingHour[i]=parseInt(daySchedule.substring(daySchedule.indexOf("-")+1,daySchedule.lastIndexOf(":"))),$scope.library.workHoursClosingMinutes[i]=parseInt(daySchedule.substring(daySchedule.lastIndexOf(":")+1,daySchedule.length))}for(var index in $scope.library.librarians)UserResource.get({id:$scope.library.librarians[index]},function(data){$scope.currentLibrarians.push(data),$scope.library.librarians.splice($scope.library.librarians.indexOf(data),1),console.log($scope.library.librarians)});void 0===data.librarySections.sectionsTheme&&(data.librarySections.sectionsTheme=[]);for(var i=0;i<data.librarySections.sectionsCount;i++)void 0===data.librarySections.sectionsTheme[i]&&(data.librarySections.sectionsTheme[i]="")}),$scope.predicate="_id",$scope.reverse=!1,$http({method:"get",cache:!0,url:"/api/currency"}).success(function(data){$scope.currency=data}).error(function(err){console.log(err)}),$scope.updateLibrary=function(library,librarians){for(var workdays=[],workhours=[],workhoursString="",i=0;7>i;i++)library.workdays[i]===!0&&(workdays[i]=!0,workhoursString=library.workHoursOpeningHour[i]+":"+library.workHoursOpeningMinutes[i]+"-"+library.workHoursClosingHour[i]+":"+library.workHoursClosingMinutes[i],workhours[i]=workhoursString);delete library.workdays,delete library.workhours,library.workdays=workdays,library.workhours=workhours;for(var i=0;i<$scope.removedLibrarians.length;i++)User.updateAsAdmin($scope.removedLibrarians[i]);for(var i=0;i<librarians.length;i++)librarians[i].roles=[],librarians[i].roles.push("librarian");if(library.hasOwnProperty("librarians"))for(var i=0;i<library.librarians.length;i++)if(library.librarians[i].hasOwnProperty("roles")===!1||-1===library.librarians[i].roles.indexOf("librarian"))for(var j=0;j<$scope.users.length;j++)$scope.users[j]._id===library.librarians[i]._id&&($scope.users[j].roles.push("librarian"),User.updateAsAdmin($scope.users[j]).then(function(){},function(reason){notifier.error(reason)}));for(var index in $scope.currentLibrarians)library.librarians.push($scope.currentLibrarians[index]._id);console.log(librarians),Library.updateLibrary(library,librarians).then(function(){notifier.success("Library updated!"),$window.location.href=identity.ownLibraryID?"/library-panel":"/"},function(reason){reason instanceof Object?($scope.mongooseErrors=reason.data.reason.errors||[reason],console.log($scope.mongooseErrors),notifier.error($filter("titleCase")(reason.data.reason.name))):notifier.error(reason)})},$scope.removedLibrarians=[],$scope.removeCurrentLibrarian=function(librarian){$scope.currentLibrarians.splice($scope.currentLibrarians.indexOf(librarian),1),librarian.ownLibraryID="",librarian.roles.indexOf("librarian")>-1&&librarian.roles.splice(librarian.roles.indexOf("librarian"),1),librarian.roles.indexOf("libraryOwner")>-1&&librarian.roles.splice(librarian.roles.indexOf("libraryOwner"),1),$scope.removedLibrarians.push(librarian)},$http({method:"get",cache:!0,url:"/api/countries"}).success(function(data){$scope.countries=data}).error(function(err){console.log(err)}),$http({method:"get",url:"/api/users"}).success(function(data){$scope.users=[];for(var user in data)""!==data[user].ownLibraryID&&data[user].ownLibraryID||$scope.users.push(data[user])}).error(function(err){console.log(err)}),$scope.setFileEventListener=function(element){$scope.uploadedFile=element.files[0],void 0===$scope.library&&($scope.library=new Object({})),$scope.library.active=!0,$scope.uploadedFile&&$scope.$apply(function(){$scope.uploadButtonState=!0})},$scope.uploadFile=function(){$scope.uploadedFile&&ajaxPost.uploadFileInit($scope.uploadedFile).then(function(result){200===result.status&&($scope.library.certificate=result.data,$scope.certificateUploadSuccessful=!0,$scope.certificateUploadError=!1,$scope.certificateTypeError=!1,$scope.uploadButtonState=!0,$scope.uploadedFile=!0)},function(error){console.log(error),"Invalid mime type"===error.data?$scope.certificateTypeError=!0:$scope.certificateUploadError=!0,$scope.certificateError=error.data})},$scope.librariansCount=0,$scope.librarians=[];for(var i=0;i<$scope.librariansCount;i++)$scope.librarians[i]=new Object({index:i});$scope.addLibrarian=function(){$scope.librarians[$scope.librariansCount]=new Object({index:$scope.librariansCount}),$scope.librariansCount++},$scope.removeLibrarian=function(index){$scope.librarians.splice(index,1),$scope.librariansCount--},$scope.changeSectionsCount=function(){void 0===$scope.library.librarySections.sectionsTheme&&($scope.library.librarySections.sectionsTheme=[]);for(var i=0;i<$scope.library.librarySections.sectionsCount;i++)void 0===$scope.library.librarySections.sectionsTheme[i]&&($scope.library.librarySections.sectionsTheme[i]="");$scope.library.librarySections.sectionsTheme.length=$scope.library.librarySections.sectionsCount}}),app.controller("BookingReservationsCtrl",function($scope,BookingResourceSortable,$routeParams,$http,identity){$scope.page=1,$scope.perPage=10,$scope.field="_id",$scope.order="asc",$scope.user=identity.currentUser,$scope.range=function(n){return new Array(n)},$scope.pages=function(){$http.get("/api/library/booking-count/"+$scope.user.ownLibraryID).success(function(data){console.log(data),$scope.usersCount=parseInt(data),$scope.pagesCount=Math.ceil($scope.usersCount/$scope.perPage)})},$scope.bookings=BookingResourceSortable.query({libraryID:$scope.user.ownLibraryID,field:$scope.field,order:$scope.order,page:$scope.page,perPage:$scope.perPage}),$scope.setPage=function(page,event){$scope.page=page,angular.element(".pagination li").removeClass("active"),angular.element("#"+event.target.id).parent().addClass("active")},$scope.setPerPage=function(perPage){$scope.perPage=perPage},$scope.sort=function(event){$scope.field=event.target.id,$scope.order=$scope.order="asc"===$scope.order?"desc":"asc"},$scope.reloadBookings=function(){$scope.bookings=BookingResourceSortable.query({libraryID:$scope.user.ownLibraryID,field:$scope.field,order:$scope.order,page:$scope.page,perPage:$scope.perPage})}}),app.controller("BooksTakenCtrl",function($scope,ReadingResourceSortable,$routeParams,$http,identity){$scope.page=1,$scope.perPage=10,$scope.field="_id",$scope.order="asc",$scope.user=identity.currentUser,$scope.range=function(n){return new Array(n)},$scope.pages=function(){$http.get("/api/library/reading-count/"+$scope.user.ownLibraryID).success(function(data){console.log(data),$scope.usersCount=parseInt(data),$scope.pagesCount=Math.ceil($scope.usersCount/$scope.perPage)})},console.log($scope.user.ownLibraryID),$scope.readings=ReadingResourceSortable.query({libraryID:$scope.user.ownLibraryID,field:$scope.field,order:$scope.order,page:$scope.page,perPage:$scope.perPage}),$scope.setPage=function(page,event){$scope.page=page,angular.element(".pagination li").removeClass("active"),angular.element("#"+event.target.id).parent().addClass("active")},$scope.setPerPage=function(perPage){$scope.perPage=perPage},$scope.sort=function(event){$scope.field=event.target.id,$scope.order=$scope.order="asc"===$scope.order?"desc":"asc"},$scope.reloadReadings=function(){$scope.readings=ReadingResourceSortable.query({libraryID:$scope.user.ownLibraryID,field:$scope.field,order:$scope.order,page:$scope.page,perPage:$scope.perPage})}}),app.controller("LibraryUsers2Ctrl",function($scope,LibraryUsersResourceSortable,$routeParams,$http,identity){$scope.page=1,$scope.perPage=10,$scope.field="_id",$scope.order="asc",$scope.user=identity.currentUser,$scope.range=function(n){return new Array(n)},$scope.pages=function(){$http.get("/api/library/user-count").success(function(data){$scope.usersCount=parseInt(data),$scope.pagesCount=Math.ceil($scope.usersCount/$scope.perPage)})},$scope.users=LibraryUsersResourceSortable.query({id:$scope.user.ownLibraryID,field:$scope.field,order:$scope.order,page:$scope.page,perPage:$scope.perPage}),console.log($scope.users),$scope.setPage=function(page,event){$scope.page=page,angular.element(".pagination li").removeClass("active"),angular.element("#"+event.target.id).parent().addClass("active")},$scope.setPerPage=function(perPage){$scope.perPage=perPage},$scope.sort=function(event){$scope.field=event.target.id,$scope.order=$scope.order="asc"===$scope.order?"desc":"asc"},$scope.reloadUsers=function(){$scope.users=LibraryUsersResourceSortable.query({id:$scope.user.ownLibraryID,field:$scope.field,order:$scope.order,page:$scope.page,perPage:$scope.perPage})}}),app.controller("LibraryUsersCtrl",function($scope,LibraryUsersResourceSortable,$routeParams,$http,identity){$scope.page=1,$scope.perPage=10,$scope.field="_id",$scope.order="asc",$scope.user=identity.currentUser,$scope.range=function(n){return new Array(n)},$scope.pages=function(){$http.get("/api/library/user-count").success(function(data){$scope.usersCount=parseInt(data),$scope.pagesCount=Math.ceil($scope.usersCount/$scope.perPage)})},$scope.users=LibraryUsersResourceSortable.query({id:$scope.user.ownLibraryID,field:$scope.field,order:$scope.order,page:$scope.page,perPage:$scope.perPage}),$scope.setPage=function(page,event){$scope.page=page,angular.element(".pagination li").removeClass("active"),angular.element("#"+event.target.id).parent().addClass("active")},$scope.setPerPage=function(perPage){$scope.perPage=perPage},$scope.sort=function(event){$scope.field=event.target.id,$scope.order=$scope.order="asc"===$scope.order?"desc":"asc"},$scope.reloadUsers=function(){$scope.users=LibraryUsersResourceSortable.query({id:$scope.user.ownLibraryID,field:$scope.field,order:$scope.order,page:$scope.page,perPage:$scope.perPage})}}),app.controller("LibraryVisitsCtrl",function($scope,LibVisitResourceSortable,$routeParams,$http,identity){$scope.page=1,$scope.perPage=10,$scope.field="_id",$scope.order="asc",$scope.user=identity.currentUser,$scope.range=function(n){return new Array(n)},$scope.pages=function(){$http.get("/api/library/reading-count/"+$scope.user.ownLibraryID).success(function(data){console.log(data),$scope.usersCount=parseInt(data),$scope.pagesCount=Math.ceil($scope.usersCount/$scope.perPage)})},console.log($scope.user.ownLibraryID),$scope.visits=LibVisitResourceSortable.query({libraryID:$scope.user.ownLibraryID,field:$scope.field,order:$scope.order,page:$scope.page,perPage:$scope.perPage}),$scope.setPage=function(page,event){$scope.page=page,angular.element(".pagination li").removeClass("active"),angular.element("#"+event.target.id).parent().addClass("active")},$scope.setPerPage=function(perPage){$scope.perPage=perPage},$scope.sort=function(event){$scope.field=event.target.id,$scope.order=$scope.order="asc"===$scope.order?"desc":"asc"},$scope.reloadVisits=function(){$scope.visits=LibVisitResourceSortable.query({libraryID:$scope.user.ownLibraryID,field:$scope.field,order:$scope.order,page:$scope.page,perPage:$scope.perPage})}}),app.controller("UserDeleteFromLibraryCtrl",function($scope,$routeParams,$http,$location,notifier,identity){$http.get("/api/library/delete-user/"+$routeParams.id+"/"+identity.currentUser.ownLibraryID).success(function(){notifier.success("The user has been successfully unsubscribed from the library.")}),$location.path("/library-panel/users")}),app.controller("UserInfoLibraryCtrl",function($scope,identity,UserResource,UserReadingProfileResource,UserBookingsResource,LibraryResource,FavoriteBookResource,$routeParams,$location){$scope.libraryID=identity.currentUser.ownLibraryID,$scope.user=UserResource.get({id:$routeParams.id},function(data){data?(data.dateOfBirth=data.dateOfBirth||"N/A",data.facebookUrl=data.facebookUrl||"N/A",data.twitterUrl=data.twitterUrl||"N/A",data.googlePlusUrl=data.googlePlusUrl||"N/A",data.aboutMe=data.aboutMe||"N/A"):$location.path("/404"),data.libraries=[],data.readings=UserReadingProfileResource.get({userID:data._id}),data.bookings=UserBookingsResource.get({userID:data._id});for(var lib=0;lib<data.librarySubscriptions.length;lib++)data.libraries[lib]=LibraryResource.get({id:data.librarySubscriptions[lib]})},function(){$location.path("/404")}),$scope.favoriteBooks=FavoriteBookResource.get({userID:$routeParams.id})}),app.controller("UserInteractLibraryCtrl",function($scope,$location,UserResource,$routeParams,$route,$timeout,identity,LibraryUsersInteractions,LibraryResource,notifier,$http,LibBooksResource,UserNotReturnedResource){$scope.books=LibBooksResource.query({id:identity.currentUser.ownLibraryID,available:!0,userID:$routeParams.id}),$scope.booksToReturn=UserNotReturnedResource.query({userID:$routeParams.id,libraryID:identity.currentUser.ownLibraryID}),$scope.library=LibraryResource.get({id:identity.currentUser.ownLibraryID}),$scope.user=UserResource.get({id:$routeParams.id},function(data){if(data){var url="/api/library/pending/"+$scope.user.id+"/"+identity.currentUser.ownLibraryID;$http.get(url).success(function(pendings){for(var i=0;i<pendings.length;i++)null!==pendings[i].book&&("booking"===pendings[i].type?(pendings[i].book.end=pendings[i].end,$scope.bookings.push(pendings[i].book)):"reading"===pendings[i].type&&(pendings[i].book.end=pendings[i].end,$scope.readings.push(pendings[i].book)));$scope.bookings.length>0&&($scope.bookings[0].open=!0),$scope.readings.length>0&&($scope.readings[0].open=!0)}).error(function(err){notifier.error(err.data)})}else $location.path("/404")},function(){$location.path("/404")}),$scope.bookings=[],$scope.readings=[],$scope.giveBook=function(give){give.userID=$routeParams.id,give.userName=$scope.user.username,give.libraryID=identity.currentUser.ownLibraryID,give.libraryName=$scope.library.name,give.librarian1ID=identity.currentUser._id,give.startDate=new Date,give.endDate=new Date((new Date).getTime()+2592e6),console.log(give),delete give._id,delete give.__v,LibraryUsersInteractions.giveBook(give).then(function(){notifier.success(give.bookName+" given successfully!"),$route.reload()},function(reason){notifier.error(reason.data)})},$scope.returnBook=function(interact){interact.userID=$routeParams.id,interact.libraryID=identity.currentUser.ownLibraryID,interact.librarian2ID=identity.currentUser._id,interact.returnDate=new Date,interact.comment=$scope.returnBook.comment,delete interact._id,delete interact.__v,LibraryUsersInteractions.returnBook(interact).then(function(){notifier.success(interact.bookName+" returned successfully!"),$route.reload()},function(reason){notifier.error(reason.data)})}}),app.controller("MainCtrl",function($scope,cachedLibraries,identity){$scope.identity=identity,$scope.libraries=cachedLibraries.query().then(function(collection){$scope.libraries=collection})}),app.controller("AdvancedSearchCtrl",function($scope,$http){$scope.text=void 0,$scope.fileread=void 0,$scope.uploadError=void 0,$scope.loading=0,$scope.findBookByText=function(){$scope.loading++,$scope.uploadError=void 0,$http.post("/api/books/full-text",{text:$scope.citation}).success(function(books){console.log(books),books.length?$scope.text=books:$scope.uploadError="No books found!"}).error(function(err){$scope.uploadError=err.reason||err,console.log($scope.uploadError)}).finally(function(){$scope.loading--})}}),app.directive("barcodeGenerator",[function(){var Barcode=function(){var barcode={settings:{barWidth:1,barHeight:50,addQuietZone:!0},intval:function(val){var type=typeof val;return"string"===type?(val=val.replace(/[^0-9-.]/g,""),val=parseInt(1*val,10),isNaN(val)||!isFinite(val)?0:val):"number"===type&&isFinite(val)?Math.floor(val):0},code128:{encoding:["11011001100","11001101100","11001100110","10010011000","10010001100","10001001100","10011001000","10011000100","10001100100","11001001000","11001000100","11000100100","10110011100","10011011100","10011001110","10111001100","10011101100","10011100110","11001110010","11001011100","11001001110","11011100100","11001110100","11101101110","11101001100","11100101100","11100100110","11101100100","11100110100","11100110010","11011011000","11011000110","11000110110","10100011000","10001011000","10001000110","10110001000","10001101000","10001100010","11010001000","11000101000","11000100010","10110111000","10110001110","10001101110","10111011000","10111000110","10001110110","11101110110","11010001110","11000101110","11011101000","11011100010","11011101110","11101011000","11101000110","11100010110","11101101000","11101100010","11100011010","11101111010","11001000010","11110001010","10100110000","10100001100","10010110000","10010000110","10000101100","10000100110","10110010000","10110000100","10011010000","10011000010","10000110100","10000110010","11000010010","11001010000","11110111010","11000010100","10001111010","10100111100","10010111100","10010011110","10111100100","10011110100","10011110010","11110100100","11110010100","11110010010","11011011110","11011110110","11110110110","10101111000","10100011110","10001011110","10111101000","10111100010","11110101000","11110100010","10111011110","10111101110","11101011110","11110101110","11010000100","11010010000","11010011100","11000111010"],getDigit:function(code){var tableB=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",result="",sum=0,isum=0,i=0,j=0,value=0;for(i=0;i<code.length;i++)if(-1===tableB.indexOf(code.charAt(i)))return"";var tableCActivated=code.length>1,c="";for(i=0;3>i&&i<code.length;i++)c=code.charAt(i),tableCActivated&=c>="0"&&"9">=c;for(sum=tableCActivated?105:104,result=this.encoding[sum],i=0;i<code.length;){if(tableCActivated)(i===code.length||code.charAt(i)<"0"||code.charAt(i)>"9"||code.charAt(i+1)<"0"||code.charAt(i+1)>"9")&&(tableCActivated=!1,result+=this.encoding[100],sum+=100*++isum);else{for(j=0;i+j<code.length&&code.charAt(i+j)>="0"&&code.charAt(i+j)<="9";)j++;tableCActivated=j>5||i+j-1===code.length&&j>3,tableCActivated&&(result+=this.encoding[99],sum+=99*++isum)}tableCActivated?(value=barcode.intval(code.charAt(i)+code.charAt(i+1)),i+=2):(value=tableB.indexOf(code.charAt(i)),i+=1),result+=this.encoding[value],sum+=++isum*value}return result+=this.encoding[sum%103],result+=this.encoding[106],result+="11"}},bitStringTo2DArray:function(digit){var d=[];d[0]=[];for(var i=0;i<digit.length;i++)d[0][i]=digit.charAt(i);return d},digitToCanvasRenderer:function($container,settings,digit,hri,mw,mh){var len,current,lines=digit.length,columns=digit[0].length,canvas=document.createElement("canvas"),currentWidth=0,ctx=canvas.getContext("2d");canvas.setAttribute("width",digit[0].length*mw);var style="width: 400px; background: #fff;";canvas.setAttribute("style",style),canvas.className="barcode code128 clearfix-child";for(var x=0;lines>x;x++){len=0,current=digit[x][0];for(var y=0;columns>y;y++)current===digit[x][y]?len++:("0"!==current&&(ctx.beginPath(),ctx.fillStyle="#000",ctx.fillRect(currentWidth,0,len*mw,mh)),currentWidth+=len*mw,current=digit[x][y],len=1);len>0&&("0"!==current&&(ctx.beginPath(),ctx.fillStyle="#000",ctx.fillRect(currentWidth,0,len*mw,mh)),currentWidth+=len*mw)}return ctx.closePath(),canvas},digitToCanvas:function($container,settings,digit,hri){var w=barcode.intval(settings.barWidth),h=barcode.intval(settings.barHeight);return this.digitToCanvasRenderer($container,settings,this.bitStringTo2DArray(digit),hri,w,h)}},generate=function(datas,settings){var digit="",hri="",code="",crc=!0,rect=!1,b2d=!1;if("string"==typeof datas?code=datas:"object"==typeof datas&&(code="string"==typeof datas.code?datas.code:"",crc="undefined"!=typeof datas.crc?datas.crc:!0,rect="undefined"!=typeof datas.rect?datas.rect:!1),""===code)return!1;"undefined"==typeof settings&&(settings=[]);for(var name in barcode.settings)void 0===settings[name]&&(settings[name]=barcode.settings[name]);
if(digit=barcode.code128.getDigit(code),hri=code,0===digit.length)return this;!b2d&&settings.addQuietZone&&(digit="0000000000"+digit+"0000000000");var fname="digitToCanvas"+(b2d?"2D":"");return barcode[fname](this,settings,digit,hri)};return generate}(),IDCard=function(){var generate=function(barcode,user){var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");canvas.setAttribute("width",barcode.width+50);var style="width: 350px; background: transparent; height: 100%";canvas.setAttribute("style",style),canvas.setAttribute("height",200);var backgroundGradient=ctx.createLinearGradient(0,0,0,80);backgroundGradient.addColorStop(0,"#06f"),backgroundGradient.addColorStop(1,"#fff"),ctx.fillStyle=backgroundGradient;var cornerRadius=4;ctx.lineJoin="round",ctx.lineWidth=cornerRadius,ctx.strokeStyle="#06f",ctx.strokeRect(0+cornerRadius/2,0+cornerRadius/2,330-cornerRadius,200-cornerRadius),ctx.fillRect(0+cornerRadius/2,0+cornerRadius/2,330-cornerRadius,200-cornerRadius);var img=new Image;img.src="../../dist/images/logo-new-white.png",img.onload=function(){ctx.drawImage(this,65,15,200,50),angular.element(document.querySelector(".canvas-wrapper")).attr("href",canvas.toDataURL()),angular.element(document.querySelector(".canvas-image")).attr("src",canvas.toDataURL())},ctx.beginPath(),ctx.drawImage(barcode,25,75),ctx.beginPath(),ctx.textAlign="center",ctx.fillStyle="#333",ctx.font="15px Arial",ctx.fillText("ID: "+user.id,160,140),ctx.beginPath(),ctx.fillStyle="#06f",ctx.font="25px Arial";var name=user.firstName+" "+user.lastName;return ctx.fillText(name,160,175),canvas};return generate}();return{link:function(scope,element,attrs){attrs.$observe("barcodeGenerator",function(userString){var user=JSON.parse(userString),request=new XMLHttpRequest;request.open("GET","../../dist/images/logo-new-white.png",!0),request.onreadystatechange=function(){if(4===request.readyState&&200===request.status){var barcode=new Barcode(user.id,{barWidth:2}),card=new IDCard(barcode,user),codeWrapper=angular.element('<a class="canvas-wrapper" href="'+card.toDataURL()+'" download="'+user.username+'-sCOOLbry-IDCard"></a>'),canvasToImage=document.createElement("img");canvasToImage.setAttribute("src",card.toDataURL()),canvasToImage.setAttribute("class","canvas-image"),card.appendChild(canvasToImage),codeWrapper.append(card),angular.element(element).html("").append(codeWrapper)}},request.send(null)})}}}]),app.directive("checkAvailability",function($http){return{restrict:"A",scope:{currentValue:"=checkAvailability",field:"=ngModel"},require:"ngModel",link:function(scope,elem,attrs,ngModel){scope.$watch("field",function(value){if(value!==scope.currentValue){var responsePromise=$http.get("/api/"+attrs.name+"Available/"+value);responsePromise.success(function(data){data===!0?ngModel.$setValidity("available",!1):ngModel.$setValidity("available",!0)})}else ngModel.$setValidity("available",!0)})}}}),app.directive("databaseImport",function(notifier,XLSXReaderService,XLSReaderService){return{restrict:"E",transclude:!0,replace:!0,scope:{content:"=",result:"=",file:"="},templateUrl:"../../views/directive-templates/databaseImport.html",link:function(scope,element){element.on("keyup",function(){if(null!==scope.content){var content={csv:scope.content};scope.result=csvToArray(content),scope.$apply()}}),element.on("change",function(onChangeEvent){var file=(onChangeEvent.srcElement||onChangeEvent.target).files[0],extension=file.name.substring(file.name.lastIndexOf("."));if(".csv"===extension){var reader=new FileReader;if(reader.onload=function(onLoadEvent){scope.$apply(function(){var content={csv:onLoadEvent.target.result};scope.content=content.csv,scope.result=csvToArray(content),scope.file=file})},"file"!==onChangeEvent.target.type||null===onChangeEvent.target.files&&null===onChangeEvent.srcElement.files){if(null!==scope.content){var content={csv:scope.content};scope.result=csvToArray(content),scope.file=file}}else reader.readAsText(file)}else".xlsx"===extension?XLSXReaderService.readFile(file,!0).then(function(xlsxData){scope.result=xlsxData,scope.file=file}):".xls"===extension?XLSReaderService.readFile(file,!0).then(function(xlsData){scope.result=xlsData,scope.file=file}):notifier.error("Wrong file type! Please upload CSV, XLS or XSLX file!")});var csvToArray=function(content){content.csv=content.csv.replace("\r\n","\n").replace("\r","\n");for(var lines=content.csv.split("\n"),result=[],separator=-1!==lines[0].indexOf(",")&&lines[0].indexOf(",")>lines[0].indexOf(";")?",":";",columnCount=lines[0].split(separator).length,i=0;i<lines.length;i++){var currentlineWords=lines[i].split(separator);if(currentlineWords.length<=columnCount)result.push(currentlineWords);else{for(var shrinkedWords=[],j=0;columnCount>j;j++)shrinkedWords.push(currentlineWords[j]);result.push(shrinkedWords)}}return result}}}}),app.directive("fallbackSrc",function(){var loadingDefault="data:image/gif;base64,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";
return{restrict:"A",link:function(scope,element,attr){element[0].src=attr.loadingSrc?attr.loadingSrc:loadingDefault;var img=angular.element("<img />");img.src=scope.ngSrc,img.on("load",function(){element[0].src=img.src})}}}),app.directive("fieldsMatch",function(){return{restrict:"A",require:"ngModel",link:function(scope,elem,attrs,ctrl){var firstPreviousValue,secondPreviousValue,fieldsMatch=function(first,second){var validity=first===second?!0:!1;ctrl.$setValidity("fieldsMatch",validity)};scope.$watch(attrs.ngModel,function(newValue){firstPreviousValue=newValue,secondPreviousValue&&fieldsMatch(newValue,secondPreviousValue)}),scope.$watch(attrs.fieldsMatch,function(newValue){secondPreviousValue=newValue,firstPreviousValue&&fieldsMatch(newValue,firstPreviousValue)})}}}),app.directive("fileupload",function($http){return{scope:{fileread:"=",text:"=",uploadError:"=",loading:"="},link:function(scope,element){console.log("inside"),scope.loading=0,scope.uploadError=void 0,element.bind("change",function(changeEvent){console.log("change"),scope.$apply(function(){scope.fileupload=changeEvent.target.files[0]});var fd=new FormData;fd.append("file",changeEvent.target.files[0]),scope.uploadError=void 0,scope.text=void 0,scope.loading++,$http.post("/api/image/text",fd,{withCredentials:!0,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(data){console.log(data),$http.post("/api/books/full-text",{text:data}).success(function(books){console.log(books),books.length?scope.text=books:scope.uploadError="No books found!"}).error(function(err){console.log(err),scope.uploadError=err.reason||err}).finally(function(){scope.loading--})}).error(function error(error){console.log(error),scope.uploadError=error&&error.reason&&error.reason.name,scope.loading--})})}}}),app.directive("getBookExisting",function($http,LibBookResource,notifier){return{restrict:"A",link:function(scope,elem,attrs){scope.$watch(attrs.ngShow,function(newValue){if(newValue===!0){var findInDatabasePromise=$http.get("/api/book/findByISBN/"+attrs.isbn);findInDatabasePromise.success(function(data){LibBookResource.get({bookID:data._id,libraryID:scope.library._id},function(){scope.foundBookId=data._id,console.log("in lib")},function(err){404===err.status?(scope.book=data,scope.book.foundInDatabase=!0,console.log("not in lib"),console.log(data),scope.bookForm.isbn.$setValidity("available",!0)):notifier.error(err.data)})})}})}}}),app.directive("getBookLink",function($http){return{restrict:"A",link:function(scope,elem,attrs){scope.$watch(attrs.ngShow,function(newValue){if(newValue===!0){var findInDatabasePromise=$http.get("/api/book/findByISBN/"+attrs.isbn);findInDatabasePromise.success(function(data){scope.foundBookId=data._id})}})}}}),app.directive("loadingButton",function(){return{restrict:"A",link:function($scope,$elem){$elem.click(function(){$elem.button("loading")}),$scope.$watchGroup(["user.avatar","searchState","library.certificate","book.cover","book.ebookUrl","ebookUploadError","avatarError","certificateError","coverError"],function(){$elem.button("reset")})}}}),app.directive("ngConfirmClick",[function(){return{priority:-1,restrict:"A",link:function(scope,element,attrs){element.bind("click",function(e){var message=attrs.ngConfirmClick;message&&!confirm(message)&&(e.stopImmediatePropagation(),e.preventDefault())})}}}]),app.directive("onFocus",function(){return{restrict:"A",link:function(scope,element){element.focus()}}}),app.directive("resize",function($window){return function(scope){var w=angular.element($window);scope.getWindowDimensions=function(){return{h:w.height(),w:w.width()}},scope.$watch(scope.getWindowDimensions,function(newValue){scope.windowHeight=newValue.h,scope.windowWidth=newValue.w},!0),w.bind("resize",function(){scope.$apply()})}}),app.directive("selectPicker",function(){return{restrict:"A",link:function($scope,$elem){$scope.$watch("books",function(){$elem.selectpicker("refresh")})}}}),app.directive("timePassed",function(){var timeToText=function(secondsPassed){switch(!0){case 60>secondsPassed:return"less than a minute ago";case 120>secondsPassed:return"a minute ago";case 3600>secondsPassed:return Math.floor(secondsPassed/60)+" minutes ago";case 7200>secondsPassed:return"an hour ago";case 86400>secondsPassed:return Math.floor(secondsPassed/3600)+" hours ago";case 172800>secondsPassed:return"Yesterday";case 2592e3>secondsPassed:return Math.floor(secondsPassed/86400)+" days ago";case 5184e3>secondsPassed:return"a month ago";case 31104e4>secondsPassed:return Math.floor(secondsPassed/2592e3)+" months ago";case 62208e4>secondsPassed:return"an year ago";default:return Math.floor(secondsPassed/31104e4)+" years ago"}},getSecondsPassed=function(notificationDate){var now=new Date,secondsPassed=(now-notificationDate)/1e3;return secondsPassed};return{restrict:"A",transclude:!0,link:function(scope,element){var notificationDate=new Date(scope.notification.date),seconds=getSecondsPassed(notificationDate),text=timeToText(seconds);element.text(text)}}}),app.filter("cut",function(){return function(value,wordwise,max,tail){if(!value)return"";if(max=parseInt(max,10),!max)return value;if(value.length<=max)return value;if(value=value.substr(0,max),wordwise){var lastspace=value.lastIndexOf(" ");-1!==lastspace&&(value=value.substr(0,lastspace))}return value+(tail||" ")}}),app.filter("propsFilter",function(){return function(items,props){var out=[];return angular.isArray(items)?items.forEach(function(item){for(var itemMatches=!1,keys=Object.keys(props),i=0;i<keys.length;i++){var prop=keys[i],text=props[prop].toLowerCase();if(-1!==item[prop].toString().toLowerCase().indexOf(text)){itemMatches=!0;break}}itemMatches&&out.push(item)}):out=items,out}}),app.filter("reverse",function(){return function(items){return console.log("items: "+items),items.slice().reverse()}}),app.filter("startFrom",function(){return function(input,start){return start=+start,input.slice(start)}}),app.filter("titleCase",function(){return function(input){return"string"==typeof input?input.charAt(0).toUpperCase()+input.substr(1).replace(/[A-Z]/g," $&"):input}}),app.factory("ajaxPost",["$http",function(_http){return{uploadFileInit:function(uploadedFile){var fd=new FormData;fd.append("uploadedFile",uploadedFile);var uploadPromise=_http.post("/api/images",fd,{headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(){});return uploadPromise}}}]),app.factory("Book",function($q,$http,BookResource,BooksResource,LibraryBook,FavoriteBookAddResource){return{importAll:function(file,matches){var deferred=$q.defer(),newBooks=new BooksResource({file:file,matches:matches});newBooks.$save().then(function(data){console.log(data),deferred.resolve()},function(response){console.log(response),deferred.reject(response)})},add:function(book,libraryID){function addBook(data){if(book.hasOwnProperty("foundInDatabase")===!0||data===!0)book.libraryID=libraryID,book.available=book.total,LibraryBook.add(book).then(function(){deferred.resolve()},function(err){deferred.reject(err)});else{var newBook=new BookResource(book);newBook.$save().then(function(data){console.log(libraryID),"undefined"!=typeof libraryID?(book.libraryID=libraryID,book._id=data._id,book.available=book.total,LibraryBook.add(book).then(function(){deferred.resolve()},function(err){deferred.reject(err)})):deferred.resolve()},function(response){deferred.reject(response)})}}var deferred=$q.defer();if(book.isbn){var responsePromise=$http.get("/api/isbnAvailable/"+book.isbn);responsePromise.success(function(data){addBook(data)},function(reason){deferred.reject(reason)})}else addBook(!1);return deferred.promise},update:function(book){var deferred=$q.defer(),updatedBook=new BookResource(book);return updatedBook._id=book._id,updatedBook.$update().then(function(){deferred.resolve()},function(response){deferred.reject(response)}),deferred.promise},addFavorite:function(book){var deferred=$q.defer();console.log(book);var favoriteBook=new FavoriteBookAddResource(book);return favoriteBook.$save().then(function(){deferred.resolve()},function(response){deferred.reject(response)}),deferred.promise}}}),app.factory("bookSearch",function($q,$http){return{search:function(isbn){var deferred=$q.defer(),promisesArray=[],isbnJustNumber=isbn.replace(/-/gi,""),countryCode="";if(countryCode=13===isbnJustNumber.length?isbnJustNumber.substring(0,6):"978"+isbnJustNumber.substring(0,3),"978619"===countryCode||"978954"===countryCode){var scrapBgBooksInPrintPromise=$http.get("/api/book/booksinprint/"+isbn,{timeout:deferred.promise});promisesArray.push(scrapBgBooksInPrintPromise),scrapBgBooksInPrintPromise.success(function(data){"false"!==data&&data!==!1&&deferred.resolve(data)})}var findInDatabasePromise=$http.get("/api/book/findByISBN/"+isbn,{timeout:deferred.promise});promisesArray.push(findInDatabasePromise),findInDatabasePromise.success(function(data){"false"!==data&&data!==!1&&(data.foundInDatabase=!0,deferred.resolve(data))});var findInAmazonPromise=$http.get("/api/book/amazonSearch/"+isbn,{timeout:deferred.promise});return promisesArray.push(findInAmazonPromise),findInAmazonPromise.success(function(data){"false"!==data&&data!==!1&&deferred.resolve(data)}),$q.all(promisesArray).then(function(){deferred.reject("Not found")}),deferred.promise}}}),app.factory("BookResource",function($resource){var BookResource=$resource("/api/books/:id",{id:"@id"},{update:{method:"PUT",isArray:!1}});return BookResource}),app.factory("BookSearchResource",function($resource){var BookSearchResource=$resource("/api/book/search/:phrase/:limit",{phrase:"@phrase",limit:"@limit"},{update:{method:"PUT",isArray:!1},get:{method:"GET",isArray:!0}});return BookSearchResource}),app.factory("BooksResource",function($resource){var BooksResource=$resource("/api/books/import",{},{save:{method:"POST"}});return BooksResource}),app.factory("FavoriteBookAddResource",function($resource){var FavoriteBookAddResource=$resource("/api/book/addFavorite",{id:"@id"},{get:{method:"GET",isArray:!0},update:{method:"PUT",isArray:!1}});return FavoriteBookAddResource}),app.factory("FavoriteBookResource",function($resource){var FavoriteBookResource=$resource("/api/book/favorites/:userID",{id:"@id"},{get:{method:"GET",isArray:!0},update:{method:"PUT",isArray:!1}});return FavoriteBookResource}),app.factory("LibBookResource2",function($resource){var LibBookResource2=$resource("/api/library/book/:id",{id:"@id"},{update:{method:"PUT",isArray:!1},get:{method:"GET",isArray:!1}});return LibBookResource2}),app.factory("cachedBooks",function(BookResource,$q){var cachedBooks;return{query:function(){var deferred=$q.defer();return cachedBooks?deferred.resolve(cachedBooks):cachedBooks=BookResource.query(function(data){deferred.resolve(data)},function(err){deferred.reject(err)}),deferred.promise}}}),app.factory("cachedLibraries",function(LibraryResource,$q){var cachedLibraries;return{query:function(){var deferred=$q.defer();return cachedLibraries?deferred.resolve(cachedLibraries):cachedLibraries=LibraryResource.query(function(data){deferred.resolve(data)},function(err){deferred.reject(err)}),deferred.promise}}}),app.factory("Fine",function($q,LibFineResource){return{add:function(fine){var deferred=$q.defer(),newFine=new LibFineResource(fine);return newFine.$save().then(function(){deferred.resolve()},function(response){deferred.reject(response)}),deferred.promise}}}),app.factory("Library",function($http,$q,UsersResource,UserResource,identity,LibraryResource,LibrarianResource){return{registerLibrary:function(library,librarian){var deferred=$q.defer(),newUser=new UsersResource(librarian);return newUser.$save().then(function(userData){library.librarians=userData._id;var newLibrary=new LibraryResource(library);newLibrary._id=userData.ownLibraryID,newLibrary.$save().then(function(libraryData){librarian.ownLibraryID=libraryData._id;var updatedUser=new UsersResource(librarian);updatedUser._id=userData._id,updatedUser.$update().then(function(){identity.currentUser=updatedUser,deferred.resolve()},function(response){deferred.reject(response.data.reason)})},function(response){deferred.reject(response.data.reason)})},function(response){deferred.reject(response.data.reason)}),deferred.promise},addLibrary:function(library,librarians){var libraryID,deferred=$q.defer(),newLibrary=new LibraryResource(library);return newLibrary.$save(function(data){libraryID=data._id;var newLibrariansCount=0,librariansUpdatedCount=0;librarians.forEach(function(element){element.ownLibraryID=libraryID;var newUser=new LibrarianResource(element);newUser.$save().then(function(data){console.log("saved"),console.log(data),$http({method:"get",url:"/api/library/addLibrarian/"+libraryID+"/"+data._id}).then(function(){newLibrariansCount++,newLibrariansCount!==librarians.length||library.librarians&&librariansUpdatedCount!==library.librarians.length||deferred.resolve()},function(err){deferred.reject(err)})},function(err){console.log("rejected"),console.log(err),deferred.reject(err)})});for(var id in library.librarians){var user=UserResource.get({id:library.librarians[id]._id});user.ownLibraryID=libraryID;var updatedUser=new UsersResource(user);updatedUser._id=library.librarians[id]._id,updatedUser.$update().then(function(){librariansUpdatedCount++,librarians&&newLibrariansCount!==librarians.length||librariansUpdatedCount!==library.librarians.length||deferred.resolve()},function(reason){deferred.reject(reason)})}library._id=libraryID},function(response){deferred.reject(response)}),deferred.promise},updateLibrary:function(library,librarians){var libraryID,deferred=$q.defer(),updatedLibrary=new LibraryResource(library);return updatedLibrary.$update().then(function(data){libraryID=data._id;var newLibrariansCount=0,librariansUpdatedCount=0;librarians.forEach(function(element){element.ownLibraryID=libraryID;var newUser=new LibrarianResource(element);newUser.$save().then(function(data){console.log("saved"),console.log(data),$http({method:"get",cache:!0,url:"/api/library/addLibrarian/"+libraryID+"/"+data._id}).then(function(){newLibrariansCount++,newLibrariansCount!==librarians.length||library.librarians&&librariansUpdatedCount!==library.librarians.length||deferred.resolve()},function(err){deferred.reject(err)})},function(err){console.log("rejected"),console.log(err),deferred.reject(err)})});for(var id in library.librarians){var user=UserResource.get({id:library.librarians[id]._id});user.ownLibraryID=libraryID;var updatedUser=new UsersResource(user);updatedUser._id=library.librarians[id]._id,updatedUser.$update().then(function(){librariansUpdatedCount++,librarians&&newLibrariansCount!==librarians.length||librariansUpdatedCount!==library.librarians.length||deferred.resolve()},function(reason){deferred.reject(reason)})}library._id=libraryID},function(response){deferred.reject(response)}),deferred.promise}}}),app.factory("LibraryBook",function($q,LibBookResource2,BookAvailabilitySubscriptionResource){return{add:function(book){var deferred=$q.defer(),updatedBook=new LibBookResource2(book);return updatedBook.$save().then(function(){deferred.resolve()},function(response){deferred.reject(response)}),deferred.promise},update:function(book){var deferred=$q.defer(),updatedBook=new LibBookResource2(book);return updatedBook._id=book._id,updatedBook.$update().then(function(){deferred.resolve()},function(response){deferred.reject(response)}),deferred.promise},subscribeForAvailabilityNotification:function(subscription){console.log(subscription);var deferred=$q.defer(),newSubscription=new BookAvailabilitySubscriptionResource(subscription);return newSubscription.$save().then(function(){deferred.resolve()},function(response){deferred.reject(response)}),deferred.promise}}}),app.factory("LibraryUsers",function($q,LibUserResource,UsersResource){return{addUserToLibrary:function(user,libraryID,paid){var deferred=$q.defer();"undefined"!=typeof libraryID&&(user.libraryID=libraryID),user.active=!paid;var newUser=new LibUserResource(user);return newUser.$save().then(function(libUserData){user.librarySubscriptions.push(libraryID);var updatedUser=new UsersResource(user);updatedUser._id=user._id,updatedUser.$update().then(function(someData){console.log(someData),deferred.resolve(libUserData)},function(response){deferred.reject(response.data.reason)})},function(response){deferred.reject(response)}),deferred.promise}}}),app.factory("LibraryUsersInteractions",function($q,BookGiveResource,BookReturnResource,BookingResource){return{giveBook:function(interaction){var deferred=$q.defer(),newReading=new BookGiveResource(interaction);return newReading.$save().then(function(){deferred.resolve()},function(response){deferred.reject(response)}),deferred.promise},returnBook:function(interaction){var deferred=$q.defer(),newReading=new BookReturnResource(interaction);return newReading.$save().then(function(){deferred.resolve()},function(response){deferred.reject(response)}),deferred.promise},addBooking:function(booking){var deferred=$q.defer(),newBooking=new BookingResource(booking);return newBooking.$save().then(function(){deferred.resolve()},function(response){deferred.reject(response)}),deferred.promise},removeBooking:function(booking){var deferred=$q.defer(),bookingToRemove=new BookingResource({id:booking._id});return bookingToRemove.$remove().then(function(){deferred.resolve()},function(response){deferred.reject(response)}),deferred.promise}}}),app.factory("BookAvailabilitySubscriptionResource",function($resource){var BookAvailabilitySubscriptionResource=$resource("/api/book/availabilitySubscription",{id:"@id"},{get:{method:"GET",isArray:!1},update:{method:"PUT",isArray:!1}});return BookAvailabilitySubscriptionResource}),app.factory("BookGiveResource",function($resource){var BookGiveResource=$resource("/api/library/add-reading/:id",{id:"@id"},{update:{method:"PUT",isArray:!1}});return BookGiveResource}),app.factory("BookReturnResource",function($resource){var BookReturnResource=$resource("/api/library/remove-reading/:id",{id:"@id"},{update:{method:"PUT",isArray:!1}});return BookReturnResource}),app.factory("BookingResource",function($resource){var BookingResource=$resource("/api/booking/:id",{id:"@id"},{update:{method:"PUT",isArray:!1},"delete":{method:"DELETE",isArray:!1}});return BookingResource}),app.factory("LibBookResource",function($resource){var LibBookResource=$resource("/api/library/book2/:bookID/:libraryID",{id:"@id"},{update:{method:"PUT",isArray:!1},get:{method:"GET",isArray:!1}});return LibBookResource}),app.factory("LibBookResource2",function($resource){var LibBookResource2=$resource("/api/library/book/:id",{id:"@id"},{update:{method:"PUT",isArray:!1},get:{method:"GET",isArray:!1}});return LibBookResource2}),app.factory("LibBooksResource",function($resource){var LibBooksResource=$resource("/api/library/books/:id/:available/:userID",{id:"@id",available:!1,userID:!1},{update:{method:"PUT",isArray:!1},get:{method:"GET",isArray:!0}});return LibBooksResource}),app.factory("LibBooksResourceSortable",function($resource){var LibBooksResourceSortable=$resource("/api/library/booksSort/:id/:field/:order/:page/:perPage/:userID",{id:"@id"},{update:{method:"PUT",isArray:!1},get:{method:"GET",isArray:!0}});return LibBooksResourceSortable}),app.factory("LibBooksSectionResource",function($resource){var LibBooksSectionResource=$resource("/api/library/section/:section/:libraryID",{id:"@id"},{update:{method:"PUT",isArray:!1},get:{method:"GET",isArray:!0}});return LibBooksSectionResource}),app.factory("LibFineResource",function($resource){var LibFineResource=$resource("/api/library/fine",{libraryID:"@libraryID"},{update:{method:"PUT",isArray:!1},get:{method:"GET",isArray:!0}});return LibFineResource}),app.factory("LibFinesResource",function($resource){var LibFinesResource=$resource("/api/library/fines/:libraryID",{id:"@id"},{update:{method:"PUT",isArray:!1},get:{method:"GET",isArray:!0}});return LibFinesResource}),app.factory("LibFinesResourceSortable",function($resource){var LibFinesResourceSortable=$resource("/api/library/fines-sort/:libraryID/:field/:order/:page/:perPage",{id:"@id"},{update:{method:"PUT",isArray:!1},get:{method:"GET",isArray:!0}});return LibFinesResourceSortable}),app.factory("LibUserResource",function($resource){var LibUserResource=$resource("/api/library/add-user",{id:"@id"},{update:{method:"PUT",isArray:!1},get:{method:"GET",isArray:!0}});return LibUserResource}),app.factory("LibrarianResource",function($resource){var LibrarianResource=$resource("/api/librarianCreate/:id",{_id:"@id"},{update:{method:"PUT",isArray:!1}});return LibrarianResource}),app.factory("LibraryReadingResource",function($resource){var LibraryReadingResource=$resource("/api/all-readings-library/:libraryID",{id:"@id"},{update:{method:"PUT",isArray:!1},get:{method:"GET",isArray:!0}});return LibraryReadingResource}),app.factory("LibraryResource",function($resource){var LibraryResource=$resource("/api/libraries/:id",{id:"@id"},{update:{method:"PUT",isArray:!1}});return LibraryResource}),app.factory("NotificationResource",function($resource){var NotificationResource=$resource("/api/notifications/:id/:userID",{id:"@_id",userID:"@userID"},{get:{method:"GET",isArray:!1},"delete":{method:"DELETE",isArray:!1}});return NotificationResource}),app.factory("NotificationService",function($http,$q,NotificationResource){return{getForUser:function(user){var deferred=$q.defer();return $http.get("/api/notifications/"+user._id).success(function(notifications){deferred.resolve(notifications)}).error(function(err){console.log(err),deferred.resolve([])}),deferred.promise},markAsSeen:function(notification){var deferred=$q.defer(),seenNotification=new NotificationResource(notification);return seenNotification.$delete().then(function(){deferred.resolve(!0)},function(reason){deferred.reject(reason.data.reason)}),deferred.promise}}}),app.factory("notifier",function(toastr){return{success:function(msg){toastr.success(msg)},error:function(msg){toastr.error(msg)}}}),app.factory("Socket",["socketFactory","$location",function(socketFactory,$location){return socketFactory({prefix:"",ioSocket:io.connect($location.protocol()+"://"+$location.host()+":"+$location.port())})}]),app.factory("BookResourceFilterable",function($resource){var BookResourceFilterable=$resource("/api/books/filter/:libraryID/:field/:order/:page/:perPage/:criteria/:phrase",{field:"uploaded",order:"desc",page:1,perPage:10,criteria:"all",phrase:" ",libraryID:"all"},{query:{method:"GET",isArray:!0}});return BookResourceFilterable.prototype.isAdmin=function(){return this.roles&&this.roles.indexOf("admin")>-1},BookResourceFilterable}),app.factory("BookResourceSortable",function($resource){var BookResourceSortable=$resource("/api/book/sort/:field/:order/:page/:perPage",{_id:"@id",field:"uploaded",order:"desc",page:1,perPage:10},{update:{method:"PUT",isArray:!1}});return BookResourceSortable.prototype.isAdmin=function(){return this.roles&&this.roles.indexOf("admin")>-1},BookResourceSortable}),app.factory("BookingResourceSortable",function($resource){var BookingResourceSortable=$resource("/api/library/booking-sort/:libraryID/:field/:order/:page/:perPage",{_id:"@id"},{update:{method:"PUT",isArray:!1}});return BookingResourceSortable.prototype.isAdmin=function(){return this.roles&&this.roles.indexOf("admin")>-1},BookingResourceSortable}),app.factory("LibVisitResourceSortable",function($resource){var LibVisitResourceSortable=$resource("/api/library/visits/:libraryID/:field/:order/:page/:perPage",{_id:"@id"},{update:{method:"PUT",isArray:!1}});return LibVisitResourceSortable.prototype.isAdmin=function(){return this.roles&&this.roles.indexOf("admin")>-1},LibVisitResourceSortable}),app.factory("LibraryResourceSortable",function($resource){var LibraryResourceSortable=$resource("/api/library/sort/:field/:order/:page/:perPage",{_id:"@id"},{update:{method:"PUT",isArray:!1}});return LibraryResourceSortable.prototype.isAdmin=function(){return this.roles&&this.roles.indexOf("admin")>-1},LibraryResourceSortable}),app.factory("LibraryUsersResourceSortable",function($resource){var LibraryUsersResourceSortable=$resource("/api/library/users/:id/:field/:order/:page/:perPage",{id:"@_id",field:"_id",order:"asc",page:"1",perPage:"10"},{update:{method:"PUT",isArray:!1}});return LibraryUsersResourceSortable}),app.factory("ReadingResourceSortable",function($resource){var ReadingResourceSortable=$resource("/api/library/reading-sort/:libraryID/:field/:order/:page/:perPage",{_id:"@id"},{update:{method:"PUT",isArray:!1}});return ReadingResourceSortable.prototype.isAdmin=function(){return this.roles&&this.roles.indexOf("admin")>-1},ReadingResourceSortable}),app.factory("UsersResourceSortable",function($resource){var UsersResourceSortable=$resource("/api/users/sort/:field/:order/:page/:perPage",{_id:"@id"},{update:{method:"PUT",isArray:!1}});return UsersResourceSortable.prototype.isAdmin=function(){return this.roles&&this.roles.indexOf("admin")>-1},UsersResourceSortable}),app.factory("User",function($http,$q,identity,UsersResource,UserResource,LibraryResource){return{signup:function(user){var deferred=$q.defer(),newUser=new UsersResource(user);return newUser.$save().then(function(){identity.currentUser=newUser,deferred.resolve()},function(response){deferred.reject(response.data.reason)}),deferred.promise},signupNoCaptcha:function(user){var deferred=$q.defer(),newUser=new UsersResource(user);return newUser.$save().then(function(){identity.currentUser=newUser,deferred.resolve()},function(response){deferred.reject(response)}),deferred.promise},login:function(user){var deferred=$q.defer();return $http.post("/login",user).success(function(response){if(response.success){var user=new UsersResource;angular.extend(user,response.user),identity.currentUser=user,deferred.resolve(!0)}else deferred.resolve(!1)}),deferred.promise},loginNoCaptcha:function(user){var deferred=$q.defer();return $http.post("/loginNoCaptcha",user).success(function(response){if(response.success){var user=new UsersResource;angular.extend(user,response.user),identity.currentUser=user,deferred.resolve(!0)}else deferred.resolve(!1)}),deferred.promise},logout:function(){var deferred=$q.defer();return $http.post("/logout").success(function(){identity.currentUser=void 0,deferred.resolve()}),deferred.promise},update:function(user){var deferred=$q.defer(),updatedUser=new UsersResource(user);return updatedUser._id=identity.currentUser._id,updatedUser.$update().then(function(){updatedUser.hasOwnProperty("roles")||(updatedUser.roles=identity.currentUser.roles),identity.currentUser=updatedUser,deferred.resolve()},function(response){deferred.reject(response.data.reason)}),deferred.promise},addAsAdmin:function(user,library,newLibrary){var deferred=$q.defer(),newUser=new UsersResource(user);if(newUser._id=user._id,void 0!==library){if(newLibrary===!0){var newLibraryResource=new LibraryResource(library);return newLibraryResource.$save(function(data){newUser.ownLibraryID=data._id,newUser.$save(function(userData){library.librarians=userData._id;var updatedLibrary=new LibraryResource(library);updatedLibrary._id=userData.ownLibraryID,updatedLibrary.$update().then(function(){deferred.resolve()},function(response){deferred.reject(response.data.reason)})},function(response){deferred.reject(response.data.reason)})},function(response){deferred.reject(response.data.reason)}),deferred.promise}return newUser.$save(function(data){library.librarians.push(data._id);var updatedLibrary=new LibraryResource(library);updatedLibrary.$update(function(data){newUser.ownLibraryID=data._id,newUser.$update().then(function(){deferred.resolve()},function(response){deferred.reject(response.data.reason)})},function(response){deferred.reject(response.data.reason)})},function(response){deferred.reject(response.data.reason)}),deferred.promise}return newUser.$save().then(function(){deferred.resolve()},function(response){deferred.reject(response.data.reason)}),deferred.promise},updateAsAdmin:function(user,library,newLibrary){var deferred=$q.defer();if(identity.currentUser.hasOwnProperty("roles")&&identity.currentUser.roles.indexOf("admin")>-1){var updatedUser=new UsersResource(user);if(updatedUser._id=user._id,void 0!==library){if(newLibrary===!0){var newLibraryResource=new LibraryResource(library);return newLibraryResource.$save(function(data){updatedUser.ownLibraryID=data._id,updatedUser.$update().then(function(){updatedUser.hasOwnProperty("roles")||(updatedUser.roles=identity.currentUser.roles),deferred.resolve()},function(response){deferred.reject(response.data.reason)})}),deferred.promise}void 0!==library.librarians&&-1===library.librarians.indexOf(user._id)&&library.librarians.push(user._id);var updatedLibrary=new LibraryResource(library);return updatedLibrary._id=library._id,updatedLibrary.$update(function(data){updatedUser.ownLibraryID=data._id,updatedUser.$update().then(function(){deferred.resolve()},function(response){deferred.reject(response.data.reason)})}),deferred.promise}return updatedUser.$update().then(function(){deferred.resolve()},function(response){deferred.reject(response.data.reason)}),deferred.promise}deferred.reject("You are not authorized for this action!")},isAuthenticated:function(){return identity.isAuthenticated()?!0:$q.reject("not authorized")},isAuthorizedForRole:function(role){return identity.isAuthorizedForRole(role)?!0:$q.reject("not authorized")}}}),app.factory("identity",function($window,UsersResource){var user;return $window.bootstrappedUserObject&&(user=new UsersResource,angular.extend(user,$window.bootstrappedUserObject)),{currentUser:user,isAuthenticated:function(){return!!this.currentUser},isAuthorizedForRole:function(userRole){if(!this.currentUser)return!1;switch(userRole){case"admin":return this.currentUser.roles.indexOf("admin")>-1?!0:!1;case"moderator":return this.currentUser.roles.indexOf("admin")>-1||this.currentUser.roles.indexOf("moderator")>-1?!0:!1;case"libraryOwner":return this.currentUser.roles.indexOf("admin")>-1||this.currentUser.roles.indexOf("libraryOwner")>-1?!0:!1;case"librarian":return this.currentUser.roles.indexOf("admin")>-1||this.currentUser.roles.indexOf("libraryOwner")>-1||this.currentUser.roles.indexOf("librarian")>-1?!0:!1;case"standart":return!0;default:return!1}}}}),app.factory("UserBookingsResource",function($resource){var UserBookingsResource=$resource("/api/library/bookings-user/:userID",{id:"@id"},{get:{method:"GET",isArray:!0},update:{method:"PUT",isArray:!1}});return UserBookingsResource}),app.factory("UserFinesResource",function($resource){var UserFinesResource=$resource("/api/library/finesUser/:userID",{id:"@id"},{get:{method:"GET",isArray:!0},update:{method:"PUT",isArray:!1}});return UserFinesResource}),app.factory("UserNotReturnedResource",function($resource){var UserNotReturnedResource=$resource("/api/library/not-returned/:libraryID/:userID",{id:"@id"},{get:{method:"GET",isArray:!0},update:{method:"PUT",isArray:!0}});return UserNotReturnedResource}),app.factory("UserReadingProfileResource",function($resource){var UserReadingProfileResource=$resource("/api/all-readings-profile/:userID",{id:"@id"},{get:{method:"GET",isArray:!0},update:{method:"PUT",isArray:!1}});return UserReadingProfileResource}),app.factory("UserReadingResource",function($resource){var UserReadingResource=$resource("/api/all-readings/:libraryID/:userID",{id:"@id"},{update:{method:"PUT",isArray:!1}});return UserReadingResource}),app.factory("UserReadingsResource",function($resource){var UserReadingsResource=$resource("/api/all-readings/:userID",{id:"@id"},{get:{method:"GET",isArray:!0},update:{method:"PUT",isArray:!0}});return UserReadingsResource}),app.factory("UserResource",function($resource){var UserResource=$resource("/api/userInfo/:id",{_id:"@id"},{update:{method:"PUT",isArray:!1}});return UserResource.prototype.isAdmin=function(){return this.roles&&this.roles.indexOf("admin")>-1},UserResource}),app.factory("UsersResource",function($resource){var UsersResource=$resource("/api/users/:id",{_id:"@id"},{update:{method:"PUT",isArray:!1}});
return UsersResource.prototype.isAdmin=function(){return this.roles&&this.roles.indexOf("admin")>-1},UsersResource.prototype.isLibrarian=function(){return this.roles&&this.roles.indexOf("librarian")>-1},UsersResource.prototype.isLibraryOwner=function(){return this.roles&&this.roles.indexOf("libraryOwner")>-1},UsersResource.prototype.isAdminOrLibrarian=function(){return this.roles&&this.roles.indexOf("admin")>-1?!0:this.roles&&this.roles.indexOf("librarian")>-1?!0:this.roles&&this.roles.indexOf("libraryOwner")>-1?!0:!1},UsersResource.prototype.hasLibraryPanel=function(){return this.roles&&this.roles.indexOf("librarian")>-1?!0:this.roles&&this.roles.indexOf("libraryOwner")>-1?!0:!1},UsersResource}),app.factory("XLSReaderService",["$q","$rootScope",function($q,$rootScope){var service=function(data){angular.extend(this,data)};return service.readFile=function(file,readCells,toJSON){var deferred=$q.defer();return new XLSReader(file,readCells,toJSON,function(data){$rootScope.$apply(function(){deferred.resolve(data)})}),deferred.promise},service}]),app.factory("XLSXReaderService",["$q","$rootScope",function($q,$rootScope){var service=function(data){angular.extend(this,data)};return service.readFile=function(file,readCells,toJSON){var deferred=$q.defer();return new XLSXReader(file,readCells,toJSON,function(data){$rootScope.$apply(function(){deferred.resolve(data)})}),deferred.promise},service}]);